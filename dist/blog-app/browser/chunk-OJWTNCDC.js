import{B as pt,n as dt,v as ut,x as Te,y as mt,z as ht}from"./chunk-SWZZ4WDK.js";import{A as y,Ab as at,Ba as De,Bb as B,C as Y,Ca as Re,Cb as ue,Da as et,Db as st,E as Ke,Ea as xe,Eb as ct,F as Le,Fa as tt,Fb as lt,G as N,H as ce,Ja as Ae,L as D,Ma as de,N as F,Na as Ee,Nb as me,O as ye,Pa as rt,Q as m,Qa as nt,R as we,Ra as Z,S as le,U as a,V as qe,Y as Je,Za as Ce,_a as X,a as w,aa as Ge,b as ne,da as ke,f as G,fa as Q,g as ie,h as oe,ha as Ye,i as $e,j as ae,ja as Ie,k as u,l as p,ma as Qe,n as Ne,na as Ze,nb as it,o as Be,p as g,pb as ee,qb as ot,r as j,t as $,ub as T,v as se,wa as Xe,z as x}from"./chunk-SCPIGO2T.js";var Wt=["mat-button",""],Ot=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],zt=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var jt="@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-icon-button.mat-mdc-icon-button{outline:solid 1px}}";var Ht=["mat-icon-button",""],Vt=["*"];var $t=new le("MAT_BUTTON_CONFIG");var Nt=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],bt=(()=>{class n{_elementRef=a(Ye);_ngZone=a(Q);_animationMode=a(Ze,{optional:!0});_focusMonitor=a(ut);_rippleLoader=a(pt);_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=e,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;constructor(){a(dt).load(mt);let e=a($t,{optional:!0}),t=this._elementRef.nativeElement,r=t.classList;this.disabledInteractive=e?.disabledInteractive??!1,this.color=e?.color??null,this._rippleLoader?.configureRipple(t,{className:"mat-mdc-button-ripple"});for(let{attribute:i,mdcClasses:o}of Nt)t.hasAttribute(i)&&r.add(...o)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(e="program",t){e?this._focusMonitor.focusVia(this._elementRef.nativeElement,e,t):this._elementRef.nativeElement.focus(t)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static \u0275fac=function(t){return new(t||n)};static \u0275dir=et({type:n,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",ee],disabled:[2,"disabled","disabled",ee],ariaDisabled:[2,"aria-disabled","ariaDisabled",ee],disabledInteractive:[2,"disabledInteractive","disabledInteractive",ee]},features:[tt]})}return n})();var cn=(()=>{class n extends bt{static \u0275fac=(()=>{let e;return function(r){return(e||(e=Ge(n)))(r||n)}})();static \u0275cmp=De({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(t,r){t&2&&(Ae("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),Ee(r.color?"mat-"+r.color:""),de("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],features:[xe],attrs:Wt,ngContentSelectors:zt,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(t,r){t&1&&(Ce(Ot),Z(0,"span",0),X(1),rt(2,"span",1),X(3,1),nt(),X(4,2),Z(5,"span",2)(6,"span",3)),t&2&&de("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mat-mdc-button-base{text-decoration:none}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-text-button-horizontal-padding, 12px);height:var(--mdc-text-button-container-height, 40px);font-family:var(--mdc-text-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-text-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-text-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-text-button-label-text-transform);font-weight:var(--mdc-text-button-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, -4px);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, -4px);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display, block)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mdc-filled-button-container-height, 40px);font-family:var(--mdc-filled-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-filled-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-filled-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-filled-button-label-text-transform);font-weight:var(--mdc-filled-button-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-filled-button-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -8px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -8px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display, block)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, var(--mat-sys-on-primary));background-color:var(--mdc-filled-button-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mdc-filled-button-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mdc-protected-button-container-elevation-shadow, var(--mat-sys-level1));height:var(--mdc-protected-button-container-height, 40px);font-family:var(--mdc-protected-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-protected-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-protected-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-protected-button-label-text-transform);font-weight:var(--mdc-protected-button-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-protected-button-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -8px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -8px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display, block)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, var(--mat-sys-primary));background-color:var(--mdc-protected-button-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mat-sys-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow, var(--mat-sys-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mdc-protected-button-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mdc-outlined-button-container-height, 40px);font-family:var(--mdc-outlined-button-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mdc-outlined-button-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mdc-outlined-button-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mdc-outlined-button-label-text-transform);font-weight:var(--mdc-outlined-button-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mdc-outlined-button-container-shape, var(--mat-sys-corner-full));border-width:var(--mdc-outlined-button-outline-width, 1px);padding:0 var(--mat-outlined-button-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -8px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -8px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display, block)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, var(--mat-sys-primary));border-color:var(--mdc-outlined-button-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mdc-outlined-button-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button .mdc-button__ripple{border-width:var(--mdc-outlined-button-outline-width, 1px);border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus>.mat-focus-indicator::before,.mat-mdc-raised-button:focus>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus>.mat-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}',"@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-icon-button.mat-mdc-icon-button{outline:solid 1px}}"],encapsulation:2,changeDetection:0})}return n})();var ln=(()=>{class n extends bt{constructor(){super(),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=De({type:n,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(t,r){t&2&&(Ae("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),Ee(r.color?"mat-"+r.color:""),de("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],features:[xe],attrs:Ht,ngContentSelectors:Vt,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(t,r){t&1&&(Ce(),Z(0,"span",0),X(1),Z(2,"span",1)(3,"span",2))},styles:['.mat-mdc-icon-button{-webkit-user-select:none;user-select:none;display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;z-index:0;overflow:visible;border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 40px);height:var(--mdc-icon-button-state-layer-size, 40px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 40px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size, 24px);color:var(--mdc-icon-button-icon-color, var(--mat-sys-on-surface-variant));-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label,.mat-mdc-icon-button .mat-icon{z-index:1;position:relative}.mat-mdc-icon-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus>.mat-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface-variant) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-icon-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-icon-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display, block)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button img,.mat-mdc-icon-button svg{width:var(--mdc-icon-button-icon-size, 24px);height:var(--mdc-icon-button-icon-size, 24px);vertical-align:baseline}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button[hidden]{display:none}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',jt],encapsulation:2,changeDetection:0})}return n})();var dn=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Re({type:n});static \u0275inj=we({imports:[Te,ht,Te]})}return n})();var ft={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var vt={parse:function(h,e){return Bt(h,ft,e)},stringify:function(h,e){return Kt(h,ft,e)}};function Bt(n,h,e){var t;if(e===void 0&&(e={}),!h.codes){h.codes={};for(var r=0;r<h.chars.length;++r)h.codes[h.chars[r]]=r}if(!e.loose&&n.length*h.bits&7)throw new SyntaxError("Invalid padding");for(var i=n.length;n[i-1]==="=";)if(--i,!e.loose&&!((n.length-i)*h.bits&7))throw new SyntaxError("Invalid padding");for(var o=new((t=e.out)!=null?t:Uint8Array)(i*h.bits/8|0),s=0,c=0,l=0,d=0;d<i;++d){var b=h.codes[n[d]];if(b===void 0)throw new SyntaxError("Invalid character "+n[d]);c=c<<h.bits|b,s+=h.bits,s>=8&&(s-=8,o[l++]=255&c>>s)}if(s>=h.bits||255&c<<8-s)throw new SyntaxError("Unexpected end of data");return o}function Kt(n,h,e){e===void 0&&(e={});for(var t=e,r=t.pad,i=r===void 0?!0:r,o=(1<<h.bits)-1,s="",c=0,l=0,d=0;d<n.length;++d)for(l=l<<8|255&n[d],c+=8;c>h.bits;)c-=h.bits,s+=h.chars[o&l>>c];if(c&&(s+=h.chars[o&l<<h.bits-c]),i)for(;s.length*h.bits&7;)s+="=";return s}function he(n,h){let e=!h?.manualCleanup;e&&!h?.injector&&Je(he);let t=e?h?.injector?.get(ke)??a(ke):null,r=Lt(h?.equal),i;h?.requireSync?i=Ie({kind:0},{equal:r}):i=Ie({kind:1,value:h?.initialValue},{equal:r});let o=n.subscribe({next:s=>i.set({kind:1,value:s}),error:s=>{if(h?.rejectErrors)throw s;i.set({kind:2,error:s})}});if(h?.requireSync&&i().kind===0)throw new ye(601,!1);return t?.onDestroy(o.unsubscribe.bind(o)),ot(()=>{let s=i();switch(s.kind){case 1:return s.value;case 2:throw s.error;case 0:throw new ye(601,!1)}},{equal:h?.equal})}function Lt(n=Object.is){return(h,e)=>h.kind===1&&e.kind===1&&n(h.value,e.value)}var pe=class{},Fe=class{constructor(h){this.passedConfigs=h}loadConfigs(){return Array.isArray(this.passedConfigs)?u(this.passedConfigs):u([this.passedConfigs])}};function qt(n){if(!n?.config)throw new Error("No config provided!");return new Fe(n.config)}var gt=new le("PASSED_CONFIG"),It=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Jt=(()=>{class n{logError(e,...t){console.error(e,...t)}logWarning(e,...t){console.warn(e,...t)}logDebug(e,...t){console.debug(e,...t)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),te=function(n){return n[n.None=0]="None",n[n.Debug=1]="Debug",n[n.Warn=2]="Warn",n[n.Error=3]="Error",n}(te||{}),v=(()=>{class n{constructor(){this.abstractLoggerService=a(It)}logError(e,t,...r){if(this.loggingIsTurnedOff(e))return;let{configId:i}=e,o=this.isObject(t)?JSON.stringify(t):t;r&&r.length?this.abstractLoggerService.logError(`[ERROR] ${i} - ${o}`,...r):this.abstractLoggerService.logError(`[ERROR] ${i} - ${o}`)}logWarning(e,t,...r){if(!this.logLevelIsSet(e)||this.loggingIsTurnedOff(e)||!this.currentLogLevelIsEqualOrSmallerThan(e,te.Warn))return;let{configId:i}=e,o=this.isObject(t)?JSON.stringify(t):t;r&&r.length?this.abstractLoggerService.logWarning(`[WARN] ${i} - ${o}`,...r):this.abstractLoggerService.logWarning(`[WARN] ${i} - ${o}`)}logDebug(e,t,...r){if(!e||!this.logLevelIsSet(e)||this.loggingIsTurnedOff(e)||!this.currentLogLevelIsEqualOrSmallerThan(e,te.Debug))return;let{configId:i}=e,o=this.isObject(t)?JSON.stringify(t):t;r&&r.length?this.abstractLoggerService.logDebug(`[DEBUG] ${i} - ${o}`,...r):this.abstractLoggerService.logDebug(`[DEBUG] ${i} - ${o}`)}currentLogLevelIsEqualOrSmallerThan(e,t){let{logLevel:r}=e||{};return r?r<=t:!1}logLevelIsSet(e){let{logLevel:t}=e||{};return t===null?!1:t!==void 0}loggingIsTurnedOff(e){let{logLevel:t}=e||{};return t===te.None}isObject(e){return Object.prototype.toString.call(e)==="[object Object]"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),E=function(n){return n[n.ConfigLoaded=0]="ConfigLoaded",n[n.CheckingAuth=1]="CheckingAuth",n[n.CheckingAuthFinished=2]="CheckingAuthFinished",n[n.CheckingAuthFinishedWithError=3]="CheckingAuthFinishedWithError",n[n.ConfigLoadingFailed=4]="ConfigLoadingFailed",n[n.CheckSessionReceived=5]="CheckSessionReceived",n[n.UserDataChanged=6]="UserDataChanged",n[n.NewAuthenticationResult=7]="NewAuthenticationResult",n[n.TokenExpired=8]="TokenExpired",n[n.IdTokenExpired=9]="IdTokenExpired",n[n.SilentRenewStarted=10]="SilentRenewStarted",n[n.SilentRenewFailed=11]="SilentRenewFailed",n}(E||{}),H=(()=>{class n{constructor(){this.notify=new $e(1)}fireEvent(e,t){this.notify.next({type:e,value:t})}registerForEvents(){return this.notify.asObservable()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Dt=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Gt=(()=>{class n{constructor(){this.loggerService=a(v),this.abstractSecurityStorage=a(Dt)}read(e,t){let{configId:r}=t;if(!r)return this.loggerService.logDebug(t,`Wanted to read '${e}' but configId was '${r}'`),null;if(!this.hasStorage())return this.loggerService.logDebug(t,`Wanted to read '${e}' but Storage was undefined`),null;let i=this.abstractSecurityStorage.read(r);return i?JSON.parse(i):null}write(e,t){let{configId:r}=t;return r?this.hasStorage()?(e=e||null,this.abstractSecurityStorage.write(r,JSON.stringify(e)),!0):(this.loggerService.logDebug(t,"Wanted to write but Storage was falsy"),!1):(this.loggerService.logDebug(t,`Wanted to write but configId was '${r}'`),!1)}remove(e,t){return this.hasStorage()?(this.abstractSecurityStorage.remove(e),!0):(this.loggerService.logDebug(t,`Wanted to remove '${e}' but Storage was falsy`),!1)}clear(e){return this.hasStorage()?(this.abstractSecurityStorage.clear(),!0):(this.loggerService.logDebug(e,"Wanted to clear storage but Storage was falsy"),!1)}hasStorage(){return typeof Storage<"u"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),R=(()=>{class n{constructor(){this.browserStorageService=a(Gt)}read(e,t){return(this.browserStorageService.read(e,t)||{})[e]}write(e,t,r){let i=this.browserStorageService.read(e,r)||{};return i[e]=t,this.browserStorageService.write(i,r)}remove(e,t){let r=this.browserStorageService.read(e,t)||{};delete r[e],this.browserStorageService.write(r,t)}clear(e){this.browserStorageService.clear(e)}resetStorageFlowData(e){this.remove("session_state",e),this.remove("storageSilentRenewRunning",e),this.remove("storageCodeFlowInProgress",e),this.remove("codeVerifier",e),this.remove("userData",e),this.remove("storageCustomParamsAuthRequest",e),this.remove("access_token_expires_at",e),this.remove("storageCustomParamsRefresh",e),this.remove("storageCustomParamsEndSession",e),this.remove("reusable_refresh_token",e)}resetAuthStateInStorage(e){this.remove("authzData",e),this.remove("reusable_refresh_token",e),this.remove("authnResult",e)}getAccessToken(e){return this.read("authzData",e)}getIdToken(e){return this.read("authnResult",e)?.id_token}getRefreshToken(e){let t=this.read("authnResult",e)?.refresh_token;return!t&&e.allowUnsafeReuseRefreshToken?this.read("reusable_refresh_token",e):t}getAuthenticationResult(e){return this.read("authnResult",e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Rt=(()=>{class n{extractJwk(e,t,r=!0){if(e.length===0)throw Yt;let i=e.filter(o=>t?.kid?o.kid===t.kid:!0).filter(o=>t?.use?o.use===t.use:!0).filter(o=>t?.kty?o.kty===t.kty:!0);if(i.length===0&&r)throw Qt;if(i.length>1&&t==null)throw Zt;return i}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function _e(n){return Rt.name+": "+n}var Yt={name:_e("InvalidArgumentError"),message:"Array of keys was empty. Unable to extract"},Qt={name:_e("NoMatchingKeysError"),message:"No key found matching the spec"},Zt={name:_e("SeveralMatchingKeysError"),message:"More than one key found. Please use spec to filter"},St=3,fe=(()=>{class n{constructor(){this.loggerService=a(v),this.document=a(T)}getTokenExpirationDate(e){if(!Object.prototype.hasOwnProperty.call(e,"exp"))return new Date(new Date().toUTCString());let t=new Date(0);return t.setUTCSeconds(e.exp),t}getSigningInputFromToken(e,t,r){if(!this.tokenIsValid(e,r))return"";let i=this.getHeaderFromToken(e,t,r),o=this.getPayloadFromToken(e,t,r);return[i,o].join(".")}getHeaderFromToken(e,t,r){return this.tokenIsValid(e,r)?this.getPartOfToken(e,0,t):{}}getPayloadFromToken(e,t,r){return r?this.tokenIsValid(e,r)?this.getPartOfToken(e,1,t):{}:{}}getSignatureFromToken(e,t,r){return this.tokenIsValid(e,r)?this.getPartOfToken(e,2,t):{}}getPartOfToken(e,t,r){let i=this.extractPartOfToken(e,t);if(r)return i;let o=this.urlBase64Decode(i);return JSON.parse(o)}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("Illegal base64url string!")}let r=typeof this.document.defaultView<"u"?this.document.defaultView?.atob(t):Buffer.from(t,"base64").toString("binary");if(!r)return"";try{return decodeURIComponent(r.split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch{return r}}tokenIsValid(e,t){return e?e.includes(".")?e.split(".").length!==St?(this.loggerService.logError(t,`token '${e}' is not valid --> token has to have exactly ${St-1} dots`),!1):!0:(this.loggerService.logError(t,`token '${e}' is not valid --> no dots included`),!1):(this.loggerService.logError(t,`token '${e}' is not valid --> token falsy`),!1)}extractPartOfToken(e,t){return e.split(".")[t]}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ue=(()=>{class n{constructor(){this.document=a(T)}getCrypto(){return this.document.defaultView?.crypto||this.document.defaultView?.msCrypto}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Xt=(()=>{class n{constructor(){this.cryptoService=a(Ue)}importVerificationKey(e,t){return this.cryptoService.getCrypto().subtle.importKey("jwk",e,t,!1,["verify"])}verifyKey(e,t,r,i){return this.cryptoService.getCrypto().subtle.verify(e,t,r,new TextEncoder().encode(i))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),xt=(()=>{class n{constructor(){this.cryptoService=a(Ue)}generateCodeChallenge(e){return this.calcHash(e).pipe(g(t=>this.base64UrlEncode(t)))}generateAtHash(e,t){return this.calcHash(e,t).pipe(g(r=>{let i=r.substr(0,r.length/2);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}))}calcHash(e,t="SHA-256"){let r=new TextEncoder().encode(e);return ae(this.cryptoService.getCrypto().subtle.digest(t,r)).pipe(g(i=>{let o=i,s=Array.from(new Uint8Array(o));return this.toHashString(s)}))}toHashString(e){let t="";for(let r of e)t+=String.fromCharCode(r);return t}base64UrlEncode(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function er(n){switch(n.charAt(0)){case"R":return{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"};case"E":return n.includes("256")?{name:"ECDSA",hash:"SHA-256"}:n.includes("384")?{name:"ECDSA",hash:"SHA-384"}:null;default:return null}}function tr(n){switch(n.charAt(0)){case"R":return"RSA";case"E":return"EC";default:throw new Error("Cannot infer kty from alg: "+n)}}function rr(n){switch(n.charAt(0)){case"R":return n.includes("256")?{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"}:n.includes("384")?{name:"RSASSA-PKCS1-v1_5",hash:"SHA-384"}:n.includes("512")?{name:"RSASSA-PKCS1-v1_5",hash:"SHA-512"}:null;case"E":return n.includes("256")?{name:"ECDSA",namedCurve:"P-256"}:n.includes("384")?{name:"ECDSA",namedCurve:"P-384"}:null;default:return null}}var ve=(()=>{class n{constructor(){this.keyAlgorithms=["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","PS256","PS384","PS512"],this.tokenHelperService=a(fe),this.loggerService=a(v),this.jwkExtractor=a(Rt),this.jwkWindowCryptoService=a(Xt),this.jwtWindowCryptoService=a(xt)}static{this.refreshTokenNoncePlaceholder="--RefreshToken--"}hasIdTokenExpired(e,t,r){let i=this.tokenHelperService.getPayloadFromToken(e,!1,t);return!this.validateIdTokenExpNotExpired(i,t,r)}validateIdTokenExpNotExpired(e,t,r){let i=this.tokenHelperService.getTokenExpirationDate(e);if(r=r||0,!i)return!1;let o=i.valueOf(),s=this.calculateNowWithOffset(r),c=o>s;return this.loggerService.logDebug(t,`Has idToken expired: ${!c} --> expires in ${this.millisToMinutesAndSeconds(o-s)} , ${new Date(o).toLocaleTimeString()} > ${new Date(s).toLocaleTimeString()}`),c}validateAccessTokenNotExpired(e,t,r){if(!e)return!0;r=r||0;let i=e.valueOf(),o=this.calculateNowWithOffset(r),s=i>o;return this.loggerService.logDebug(t,`Has accessToken expired: ${!s} --> expires in ${this.millisToMinutesAndSeconds(i-o)} , ${new Date(i).toLocaleTimeString()} > ${new Date(o).toLocaleTimeString()}`),s}validateRequiredIdToken(e,t){let r=!0;return Object.prototype.hasOwnProperty.call(e,"iss")||(r=!1,this.loggerService.logWarning(t,"iss is missing, this is required in the id_token")),Object.prototype.hasOwnProperty.call(e,"sub")||(r=!1,this.loggerService.logWarning(t,"sub is missing, this is required in the id_token")),Object.prototype.hasOwnProperty.call(e,"aud")||(r=!1,this.loggerService.logWarning(t,"aud is missing, this is required in the id_token")),Object.prototype.hasOwnProperty.call(e,"exp")||(r=!1,this.loggerService.logWarning(t,"exp is missing, this is required in the id_token")),Object.prototype.hasOwnProperty.call(e,"iat")||(r=!1,this.loggerService.logWarning(t,"iat is missing, this is required in the id_token")),r}validateIdTokenIatMaxOffset(e,t,r,i){if(r)return!0;if(!Object.prototype.hasOwnProperty.call(e,"iat"))return!1;let o=new Date(0);o.setUTCSeconds(e.iat),t=t||0;let c=new Date(new Date().toUTCString()).valueOf()-o.valueOf(),l=t*1e3;return this.loggerService.logDebug(i,`validate id token iat max offset ${c} < ${l}`),c>0?c<l:-c<l}validateIdTokenNonce(e,t,r,i){return!((e.nonce===void 0||r)&&t===n.refreshTokenNoncePlaceholder)&&e.nonce!==t?(this.loggerService.logDebug(i,"Validate_id_token_nonce failed, dataIdToken.nonce: "+e.nonce+" local_nonce:"+t),!1):!0}validateIdTokenIss(e,t,r){return e.iss!==t?(this.loggerService.logDebug(r,"Validate_id_token_iss failed, dataIdToken.iss: "+e.iss+" authWellKnownEndpoints issuer:"+t),!1):!0}validateIdTokenAud(e,t,r){return Array.isArray(e.aud)?e.aud.includes(t)?!0:(this.loggerService.logDebug(r,"Validate_id_token_aud array failed, dataIdToken.aud: "+e.aud+" client_id:"+t),!1):e.aud!==t?(this.loggerService.logDebug(r,"Validate_id_token_aud failed, dataIdToken.aud: "+e.aud+" client_id:"+t),!1):!0}validateIdTokenAzpExistsIfMoreThanOneAud(e){return e?!(Array.isArray(e.aud)&&e.aud.length>1&&!e.azp):!1}validateIdTokenAzpValid(e,t){return e?.azp?e.azp===t:!0}validateStateFromHashCallback(e,t,r){return e!==t?(this.loggerService.logDebug(r,"ValidateStateFromHashCallback failed, state: "+e+" local_state:"+t),!1):!0}validateSignatureIdToken(e,t,r){if(!e)return u(!0);if(!t||!t.keys)return u(!1);let i=this.tokenHelperService.getHeaderFromToken(e,!1,r);if(Object.keys(i).length===0&&i.constructor===Object)return this.loggerService.logWarning(r,"id token has no header data"),u(!1);let o=i.kid,s=i.alg,c=t.keys,l,d;if(!this.keyAlgorithms.includes(s))return this.loggerService.logWarning(r,"alg not supported",s),u(!1);let b=tr(s),S="sig";try{l=o?this.jwkExtractor.extractJwk(c,{kid:o,kty:b,use:S},!1):this.jwkExtractor.extractJwk(c,{kty:b,use:S},!1),l.length===0&&(l=o?this.jwkExtractor.extractJwk(c,{kid:o,kty:b}):this.jwkExtractor.extractJwk(c,{kty:b})),d=l[0]}catch(P){return this.loggerService.logError(r,P),u(!1)}let A=rr(s),f=this.tokenHelperService.getSigningInputFromToken(e,!0,r),O=this.tokenHelperService.getSignatureFromToken(e,!0,r);return ae(this.jwkWindowCryptoService.importVerificationKey(d,A)).pipe(j(P=>{let z=vt.parse(O,{loose:!0}),J=er(s);return ae(this.jwkWindowCryptoService.verifyKey(J,P,z,f))}),F(P=>{P||this.loggerService.logWarning(r,"incorrect Signature, validation failed for id_token")}))}validateIdTokenAtHash(e,t,r,i){this.loggerService.logDebug(i,"at_hash from the server:"+t);let o="SHA-256";return r.includes("384")?o="SHA-384":r.includes("512")&&(o="SHA-512"),this.jwtWindowCryptoService.generateAtHash(""+e,o).pipe(j(s=>(this.loggerService.logDebug(i,"at_hash client validation not decoded:"+s),s===t?u(!0):this.jwtWindowCryptoService.generateAtHash(""+decodeURIComponent(e),o).pipe(g(c=>(this.loggerService.logDebug(i,"-gen access--"+s),c===t))))))}millisToMinutesAndSeconds(e){let t=Math.floor(e/6e4),r=(e%6e4/1e3).toFixed(0);return t+":"+(+r<10?"0":"")+r}calculateNowWithOffset(e){return new Date(new Date().toUTCString()).valueOf()+e*1e3}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),nr={isAuthenticated:!1,allConfigsAuthenticated:[]},M=(()=>{class n{constructor(){this.storagePersistenceService=a(R),this.loggerService=a(v),this.publicEventsService=a(H),this.tokenValidationService=a(ve),this.authenticatedInternal$=new oe(nr)}get authenticated$(){return this.authenticatedInternal$.asObservable().pipe(Ke())}setAuthenticatedAndFireEvent(e){let t=this.composeAuthenticatedResult(e);this.authenticatedInternal$.next(t)}setUnauthenticatedAndFireEvent(e,t){this.storagePersistenceService.resetAuthStateInStorage(e);let r=this.composeUnAuthenticatedResult(t);this.authenticatedInternal$.next(r)}updateAndPublishAuthState(e){this.publicEventsService.fireEvent(E.NewAuthenticationResult,e)}setAuthorizationData(e,t,r,i){this.loggerService.logDebug(r,`storing the accessToken '${e}'`),this.storagePersistenceService.write("authzData",e,r),this.persistAccessTokenExpirationTime(t,r),this.setAuthenticatedAndFireEvent(i)}getAccessToken(e){if(!e||!this.isAuthenticated(e))return"";let t=this.storagePersistenceService.getAccessToken(e);return this.decodeURIComponentSafely(t)}getIdToken(e){if(!e||!this.isAuthenticated(e))return"";let t=this.storagePersistenceService.getIdToken(e);return this.decodeURIComponentSafely(t)}getRefreshToken(e){if(!e||!this.isAuthenticated(e))return"";let t=this.storagePersistenceService.getRefreshToken(e);return this.decodeURIComponentSafely(t)}getAuthenticationResult(e){return!e||!this.isAuthenticated(e)?null:this.storagePersistenceService.getAuthenticationResult(e)}areAuthStorageTokensValid(e){return!e||!this.isAuthenticated(e)?!1:this.hasIdTokenExpiredAndRenewCheckIsEnabled(e)?(this.loggerService.logDebug(e,"persisted idToken is expired"),!1):this.hasAccessTokenExpiredIfExpiryExists(e)?(this.loggerService.logDebug(e,"persisted accessToken is expired"),!1):(this.loggerService.logDebug(e,"persisted idToken and accessToken are valid"),!0)}hasIdTokenExpiredAndRenewCheckIsEnabled(e){let{renewTimeBeforeTokenExpiresInSeconds:t,triggerRefreshWhenIdTokenExpired:r,disableIdTokenValidation:i}=e;if(!r||i)return!1;let o=this.storagePersistenceService.getIdToken(e),s=this.tokenValidationService.hasIdTokenExpired(o,e,t);return s&&this.publicEventsService.fireEvent(E.IdTokenExpired,s),s}hasAccessTokenExpiredIfExpiryExists(e){let{renewTimeBeforeTokenExpiresInSeconds:t}=e,r=this.storagePersistenceService.read("access_token_expires_at",e),o=!this.tokenValidationService.validateAccessTokenNotExpired(r,e,t);return o&&this.publicEventsService.fireEvent(E.TokenExpired,o),o}isAuthenticated(e){if(!e)return p(()=>new Error("Please provide a configuration before setting up the module")),!1;let t=!!this.storagePersistenceService.getAccessToken(e),r=!!this.storagePersistenceService.getIdToken(e);return t&&r}decodeURIComponentSafely(e){return e?decodeURIComponent(e):""}persistAccessTokenExpirationTime(e,t){if(e?.expires_in){let r=new Date(new Date().toUTCString()).valueOf()+e.expires_in*1e3;this.storagePersistenceService.write("access_token_expires_at",r,t)}}composeAuthenticatedResult(e){if(e.length===1){let{configId:t}=e[0];return{isAuthenticated:!0,allConfigsAuthenticated:[{configId:t??"",isAuthenticated:!0}]}}return this.checkAllConfigsIfTheyAreAuthenticated(e)}composeUnAuthenticatedResult(e){if(e.length===1){let{configId:t}=e[0];return{isAuthenticated:!1,allConfigsAuthenticated:[{configId:t??"",isAuthenticated:!1}]}}return this.checkAllConfigsIfTheyAreAuthenticated(e)}checkAllConfigsIfTheyAreAuthenticated(e){let t=e.map(i=>({configId:i.configId??"",isAuthenticated:this.isAuthenticated(i)})),r=t.every(i=>!!i.isAuthenticated);return{allConfigsAuthenticated:t,isAuthenticated:r}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Pe="redirect",ir=(()=>{class n{constructor(){this.storageService=a(R),this.router=a(me)}checkSavedRedirectRouteAndNavigate(e){if(!e)return;let t=this.getStoredRedirectRoute(e);t!=null&&(this.deleteStoredRedirectRoute(e),this.router.navigateByUrl(t))}saveRedirectRoute(e,t){e&&this.storageService.write(Pe,t,e)}getStoredRedirectRoute(e){return this.storageService.read(Pe,e)}deleteStoredRedirectRoute(e){this.storageService.remove(Pe,e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),U=(()=>{class n{isCurrentFlowCodeFlow(e){return this.currentFlowIs("code",e)}isCurrentFlowAnyImplicitFlow(e){return this.isCurrentFlowImplicitFlowWithAccessToken(e)||this.isCurrentFlowImplicitFlowWithoutAccessToken(e)}isCurrentFlowCodeFlowWithRefreshTokens(e){if(!e)return!1;let{useRefreshToken:t}=e;return this.isCurrentFlowCodeFlow(e)&&!!t}isCurrentFlowImplicitFlowWithAccessToken(e){return this.currentFlowIs("id_token token",e)}currentFlowIs(e,t){let{responseType:r}=t;return Array.isArray(e)?e.some(i=>r===i):r===e}isCurrentFlowImplicitFlowWithoutAccessToken(e){return this.currentFlowIs("id_token",e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),or=(()=>{class n{constructor(){this.loggerService=a(v),this.cryptoService=a(Ue)}createRandom(e,t){if(e<=0)return"";e>0&&e<7&&(this.loggerService.logWarning(t,`RandomService called with ${e} but 7 chars is the minimum, returning 10 chars`),e=10);let r=e-6,i=new Uint8Array(Math.floor(r/2)),o=this.cryptoService.getCrypto();return o&&o.getRandomValues(i),Array.from(i,this.toHex).join("")+this.randomString(7)}toHex(e){return("0"+e.toString(16)).substr(-2)}randomString(e){let t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=new Uint32Array(e),o=this.cryptoService.getCrypto();if(o){o.getRandomValues(i);for(let s=0;s<e;s++)t+=r[i[s]%r.length]}return t}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),C=(()=>{class n{constructor(){this.loggerService=a(v),this.storagePersistenceService=a(R),this.randomService=a(or)}createNonce(e){let t=this.randomService.createRandom(40,e);return this.loggerService.logDebug(e,"Nonce created. nonce:"+t),this.setNonce(t,e),t}setNonce(e,t){this.storagePersistenceService.write("authNonce",e,t)}getAuthStateControl(e){return e?this.storagePersistenceService.read("authStateControl",e):""}setAuthStateControl(e,t){return t?this.storagePersistenceService.write("authStateControl",e,t):!1}getExistingOrCreateAuthStateControl(e){let t=this.storagePersistenceService.read("authStateControl",e);return t||(t=this.randomService.createRandom(40,e),this.storagePersistenceService.write("authStateControl",t,e)),t}setSessionState(e,t){this.storagePersistenceService.write("session_state",e,t)}resetStorageFlowData(e){this.storagePersistenceService.resetStorageFlowData(e)}getCodeVerifier(e){return this.storagePersistenceService.read("codeVerifier",e)}createCodeVerifier(e){let t=this.randomService.createRandom(67,e);return this.storagePersistenceService.write("codeVerifier",t,e),t}isCodeFlowInProgress(e){return!!this.storagePersistenceService.read("storageCodeFlowInProgress",e)}setCodeFlowInProgress(e){this.storagePersistenceService.write("storageCodeFlowInProgress",!0,e)}resetCodeFlowInProgress(e){this.storagePersistenceService.write("storageCodeFlowInProgress",!1,e)}isSilentRenewRunning(e){let{configId:t,silentRenewTimeoutInSeconds:r}=e,i=this.getSilentRenewRunningStorageEntry(e);if(!i||i.state==="not-running")return!1;let o=(r??0)*1e3,s=Date.parse(i.dateOfLaunchedProcessUtc),c=Date.parse(new Date().toISOString());return Math.abs(c-s)>o?(this.loggerService.logDebug(e,"silent renew process is probably stuck, state will be reset.",t),this.resetSilentRenewRunning(e),!1):i.state==="running"}setSilentRenewRunning(e){let t={state:"running",dateOfLaunchedProcessUtc:new Date().toISOString()};this.storagePersistenceService.write("storageSilentRenewRunning",JSON.stringify(t),e)}resetSilentRenewRunning(e){e&&this.storagePersistenceService.write("storageSilentRenewRunning","",e)}getSilentRenewRunningStorageEntry(e){let t=this.storagePersistenceService.read("storageSilentRenewRunning",e);return t?JSON.parse(t):{dateOfLaunchedProcessUtc:"",state:"not-running"}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Me=class{encodeKey(h){return encodeURIComponent(h)}encodeValue(h){return encodeURIComponent(h)}decodeKey(h){return decodeURIComponent(h)}decodeValue(h){return decodeURIComponent(h)}},ar=["code","state","token","id_token"],sr="auth0.com",_=(()=>{class n{constructor(){this.loggerService=a(v),this.flowsDataService=a(C),this.flowHelper=a(U),this.storagePersistenceService=a(R),this.jwtWindowCryptoService=a(xt)}getUrlParameter(e,t){if(!e||!t)return"";t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let i=new RegExp("[\\?&#]"+t+"=([^&#]*)").exec(e);return i===null?"":decodeURIComponent(i[1])}getUrlWithoutQueryParameters(e){let t=new URL(e.toString()),r=[];for(let i of t.searchParams.keys())r.push(i);return r.forEach(i=>{t.searchParams.delete(i)}),t}queryParametersExist(e,t){let r=!0;return e.forEach((i,o)=>{t.has(o)||(r=!1)}),r}isCallbackFromSts(e,t){if(t&&t.checkRedirectUrlWhenCheckingIfIsCallback){let r=new URL(e),i=this.getRedirectUrl(t);if(!i)return this.loggerService.logError(t,"UrlService.isCallbackFromSts: could not get redirectUrl from config, was: ",i),!1;let o=new URL(i),s=this.getUrlWithoutQueryParameters(o).toString(),c=this.getUrlWithoutQueryParameters(r).toString(),l=this.queryParametersExist(o.searchParams,r.searchParams);if(s!==c||!l)return!1}return ar.some(r=>!!this.getUrlParameter(e,r))}getRefreshSessionSilentRenewUrl(e,t){return this.flowHelper.isCurrentFlowCodeFlow(e)?this.createUrlCodeFlowWithSilentRenew(e,t):u(this.createUrlImplicitFlowWithSilentRenew(e,t))}getAuthorizeParUrl(e,t){let r=this.storagePersistenceService.read("authWellKnownEndPoints",t);if(!r)return this.loggerService.logError(t,"authWellKnownEndpoints is undefined"),null;let i=r.authorizationEndpoint;if(!i)return this.loggerService.logError(t,`Can not create an authorize URL when authorizationEndpoint is '${i}'`),null;let{clientId:o}=t;if(!o)return this.loggerService.logError(t,"getAuthorizeParUrl could not add clientId because it was: ",o),null;let s=i.split("?"),c=s[0],l=s[1],d=this.createHttpParams(l);return d=d.set("request_uri",e),d=d.append("client_id",o),`${c}?${d}`}getAuthorizeUrl(e,t){return e?this.flowHelper.isCurrentFlowCodeFlow(e)?this.createUrlCodeFlowAuthorize(e,t):u(this.createUrlImplicitFlowAuthorize(e,t)||""):u(null)}getEndSessionEndpoint(e){let r=this.storagePersistenceService.read("authWellKnownEndPoints",e)?.endSessionEndpoint;if(!r)return{url:"",existingParams:""};let i=r.split("?"),o=i[0],s=i[1]??"";return{url:o,existingParams:s}}getEndSessionUrl(e,t){if(!e)return null;let r=this.storagePersistenceService.getIdToken(e),{customParamsEndSessionRequest:i}=e,o=w(w({},i),t);return this.createEndSessionUrl(r,e,o)}createRevocationEndpointBodyAccessToken(e,t){let r=this.getClientId(t);if(!r)return null;let i=this.createHttpParams();return i=i.set("client_id",r),i=i.set("token",e),i=i.set("token_type_hint","access_token"),i.toString()}createRevocationEndpointBodyRefreshToken(e,t){let r=this.getClientId(t);if(!r)return null;let i=this.createHttpParams();return i=i.set("client_id",r),i=i.set("token",e),i=i.set("token_type_hint","refresh_token"),i.toString()}getRevocationEndpointUrl(e){let r=this.storagePersistenceService.read("authWellKnownEndPoints",e)?.revocationEndpoint;return r?r.split("?")[0]:null}createBodyForCodeFlowCodeRequest(e,t,r){let i=this.getClientId(t);if(!i)return null;let o=this.createHttpParams();if(o=o.set("grant_type","authorization_code"),o=o.set("client_id",i),!t.disablePkce){let l=this.flowsDataService.getCodeVerifier(t);if(!l)return this.loggerService.logError(t,"CodeVerifier is not set ",l),null;o=o.set("code_verifier",l)}o=o.set("code",e),r&&(o=this.appendCustomParams(w({},r),o));let s=this.getSilentRenewUrl(t);if(this.flowsDataService.isSilentRenewRunning(t)&&s)return o=o.set("redirect_uri",s),o.toString();let c=this.getRedirectUrl(t);return c?(o=o.set("redirect_uri",c),o.toString()):null}createBodyForCodeFlowRefreshTokensRequest(e,t,r){let i=this.getClientId(t);if(!i)return null;let o=this.createHttpParams();return o=o.set("grant_type","refresh_token"),o=o.set("client_id",i),o=o.set("refresh_token",e),r&&(o=this.appendCustomParams(w({},r),o)),o.toString()}createBodyForParCodeFlowRequest(e,t){let r=this.getRedirectUrl(e,t);if(!r)return u(null);let i=this.flowsDataService.getExistingOrCreateAuthStateControl(e),o=this.flowsDataService.createNonce(e);this.loggerService.logDebug(e,"Authorize created. adding myautostate: "+i);let s=this.flowsDataService.createCodeVerifier(e);return this.jwtWindowCryptoService.generateCodeChallenge(s).pipe(g(c=>{let{clientId:l,responseType:d,scope:b,hdParam:S,customParamsAuthRequest:A}=e,f=this.createHttpParams("");return f=f.set("client_id",l??""),f=f.append("redirect_uri",r),f=f.append("response_type",d??""),f=f.append("scope",b??""),f=f.append("nonce",o),f=f.append("state",i),f=f.append("code_challenge",c),f=f.append("code_challenge_method","S256"),S&&(f=f.append("hd",S)),A&&(f=this.appendCustomParams(w({},A),f)),t?.customParams&&(f=this.appendCustomParams(w({},t.customParams),f)),f.toString()}))}getPostLogoutRedirectUrl(e){let{postLogoutRedirectUri:t}=e;return t||(this.loggerService.logError(e,"could not get postLogoutRedirectUri, was: ",t),null)}createEndSessionUrl(e,t,r){if(this.isAuth0Endpoint(t))return this.composeAuth0Endpoint(t);let{url:i,existingParams:o}=this.getEndSessionEndpoint(t);if(!i)return null;let s=this.createHttpParams(o);e&&(s=s.set("id_token_hint",e));let c=this.getPostLogoutRedirectUrl(t);return c&&(s=s.append("post_logout_redirect_uri",c)),r&&(s=this.appendCustomParams(w({},r),s)),`${i}?${s}`}createAuthorizeUrl(e,t,r,i,o,s,c){let d=this.storagePersistenceService.read("authWellKnownEndPoints",o)?.authorizationEndpoint;if(!d)return this.loggerService.logError(o,`Can not create an authorize URL when authorizationEndpoint is '${d}'`),"";let{clientId:b,responseType:S,scope:A,hdParam:f,customParamsAuthRequest:O}=o;if(!b)return this.loggerService.logError(o,"createAuthorizeUrl could not add clientId because it was: ",b),"";if(!S)return this.loggerService.logError(o,"createAuthorizeUrl could not add responseType because it was: ",S),"";if(!A)return this.loggerService.logError(o,"createAuthorizeUrl could not add scope because it was: ",A),"";let P=d.split("?"),z=P[0],J=P[1],k=this.createHttpParams(J);k=k.set("client_id",b),k=k.append("redirect_uri",t),k=k.append("response_type",S),k=k.append("scope",A),k=k.append("nonce",r),k=k.append("state",i),this.flowHelper.isCurrentFlowCodeFlow(o)&&(k=k.append("code_challenge",e),k=k.append("code_challenge_method","S256"));let Ve=w(w({},O),c);return Object.keys(Ve).length>0&&(k=this.appendCustomParams(w({},Ve),k)),s&&(k=this.overWriteParam(k,"prompt",s)),f&&(k=k.append("hd",f)),`${z}?${k}`}createUrlImplicitFlowWithSilentRenew(e,t){let r=this.flowsDataService.getExistingOrCreateAuthStateControl(e),i=this.flowsDataService.createNonce(e),o=this.getSilentRenewUrl(e);return o?(this.loggerService.logDebug(e,"RefreshSession created. adding myautostate: ",r),this.storagePersistenceService.read("authWellKnownEndPoints",e)?this.createAuthorizeUrl("",o,i,r,e,"none",t):(this.loggerService.logError(e,"authWellKnownEndpoints is undefined"),null)):null}createUrlCodeFlowWithSilentRenew(e,t){let r=this.flowsDataService.getExistingOrCreateAuthStateControl(e),i=this.flowsDataService.createNonce(e);this.loggerService.logDebug(e,"RefreshSession created. adding myautostate: "+r);let o=this.flowsDataService.createCodeVerifier(e);return this.jwtWindowCryptoService.generateCodeChallenge(o).pipe(g(s=>{let c=this.getSilentRenewUrl(e);return c?this.storagePersistenceService.read("authWellKnownEndPoints",e)?this.createAuthorizeUrl(s,c,i,r,e,"none",t):(this.loggerService.logWarning(e,"authWellKnownEndpoints is undefined"),""):""}))}createUrlImplicitFlowAuthorize(e,t){let r=this.flowsDataService.getExistingOrCreateAuthStateControl(e),i=this.flowsDataService.createNonce(e);this.loggerService.logDebug(e,"Authorize created. adding myautostate: "+r);let o=this.getRedirectUrl(e,t);if(!o)return null;if(this.storagePersistenceService.read("authWellKnownEndPoints",e)){let{customParams:c}=t||{};return this.createAuthorizeUrl("",o,i,r,e,"",c)}return this.loggerService.logError(e,"authWellKnownEndpoints is undefined"),null}createUrlCodeFlowAuthorize(e,t){let r=this.flowsDataService.getExistingOrCreateAuthStateControl(e),i=this.flowsDataService.createNonce(e);this.loggerService.logDebug(e,"Authorize created. adding myautostate: "+r);let o=this.getRedirectUrl(e,t);return o?this.getCodeChallenge(e).pipe(g(s=>{if(this.storagePersistenceService.read("authWellKnownEndPoints",e)){let{customParams:l}=t||{};return this.createAuthorizeUrl(s,o,i,r,e,"",l)}return this.loggerService.logError(e,"authWellKnownEndpoints is undefined"),""})):u(null)}getCodeChallenge(e){if(e.disablePkce)return u("");let t=this.flowsDataService.createCodeVerifier(e);return this.jwtWindowCryptoService.generateCodeChallenge(t)}getRedirectUrl(e,t){let{redirectUrl:r}=e;return t?.redirectUrl&&(r=t.redirectUrl),r||(this.loggerService.logError(e,"could not get redirectUrl, was: ",r),null)}getSilentRenewUrl(e){let{silentRenewUrl:t}=e;return t||(this.loggerService.logError(e,"could not get silentRenewUrl, was: ",t),null)}getClientId(e){let{clientId:t}=e;return t||(this.loggerService.logError(e,"could not get clientId, was: ",t),null)}appendCustomParams(e,t){for(let[r,i]of Object.entries(w({},e)))t=t.append(r,i.toString());return t}overWriteParam(e,t,r){return e.set(t,r)}createHttpParams(e){return e=e??"",new ue({fromString:e,encoder:new Me})}isAuth0Endpoint(e){let{authority:t,useCustomAuth0Domain:r}=e;return t?t.endsWith(sr)||!!r:!1}composeAuth0Endpoint(e){let{authority:t,clientId:r}=e,i=this.getPostLogoutRedirectUrl(e);return`${t}/v2/logout?client_id=${r}&returnTo=${i}`}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),cr=(()=>{class n{constructor(){this.http=a(lt)}get(e,t){return this.http.get(e,t)}post(e,t,r){return this.http.post(e,t,r)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),lr="ngsw-bypass",V=(()=>{class n{constructor(){this.httpClient=a(cr)}get(e,t,r){let i=this.prepareHeaders(r),o=this.prepareParams(t);return this.httpClient.get(e,{headers:i,params:o})}post(e,t,r,i){let o=i||this.prepareHeaders(),s=this.prepareParams(r);return this.httpClient.post(e??"",t,{headers:o,params:s})}prepareHeaders(e){let t=new B;return t=t.set("Accept","application/json"),e&&(t=t.set("Authorization","Bearer "+decodeURIComponent(e))),t}prepareParams(e){let t=new ue,{ngswBypass:r}=e;return r&&(t=t.set(lr,"")),t}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),At=n=>!!n&&n instanceof ct&&(n.error instanceof ProgressEvent&&n.error.type==="error"||n.status===0&&!!n.error),dr=(()=>{class n{constructor(){this.urlService=a(_),this.loggerService=a(v),this.tokenValidationService=a(ve),this.flowsDataService=a(C),this.storagePersistenceService=a(R),this.dataService=a(V)}codeFlowCallback(e,t){let r=this.urlService.getUrlParameter(e,"code"),i=this.urlService.getUrlParameter(e,"state"),o=this.urlService.getUrlParameter(e,"session_state");return i?r?(this.loggerService.logDebug(t,"running validation for callback",e),u({code:r,refreshToken:"",state:i,sessionState:o,authResult:null,isRenewProcess:!1,jwtKeys:null,validationResult:null,existingIdToken:null})):(this.loggerService.logDebug(t,"no code in url"),p(()=>new Error("no code in url"))):(this.loggerService.logDebug(t,"no state in url"),p(()=>new Error("no state in url")))}codeFlowCodeRequest(e,t){let r=this.flowsDataService.getAuthStateControl(t);if(!this.tokenValidationService.validateStateFromHashCallback(e.state,r,t))return p(()=>new Error("codeFlowCodeRequest incorrect state"));let s=this.storagePersistenceService.read("authWellKnownEndPoints",t)?.tokenEndpoint;if(!s)return p(()=>new Error("Token Endpoint not defined"));let c=new B;c=c.set("Content-Type","application/x-www-form-urlencoded");let l=this.urlService.createBodyForCodeFlowCodeRequest(e.code,t,t?.customParamsCodeRequest);return this.dataService.post(s,l,t,c).pipe(D(d=>{if(d){let b=ne(w({},d),{state:e.state,session_state:e.sessionState});e.authResult=b}return u(e)}),ce(d=>this.handleRefreshRetry(d,t)),x(d=>{let{authority:b}=t,S=`OidcService code request ${b}`;return this.loggerService.logError(t,S,d),p(()=>new Error(S))}))}handleRefreshRetry(e,t){return e.pipe(j(r=>{if(At(r)){let{authority:i,refreshTokenRetryInSeconds:o}=t,s=`OidcService code request ${i} - no internet connection`;return this.loggerService.logWarning(t,s,r),se((o??0)*1e3)}return p(()=>r)}))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),I=function(n){return n.NotSet="NotSet",n.StatesDoNotMatch="StatesDoNotMatch",n.SignatureFailed="SignatureFailed",n.IncorrectNonce="IncorrectNonce",n.RequiredPropertyMissing="RequiredPropertyMissing",n.MaxOffsetExpired="MaxOffsetExpired",n.IssDoesNotMatchIssuer="IssDoesNotMatchIssuer",n.NoAuthWellKnownEndPoints="NoAuthWellKnownEndPoints",n.IncorrectAud="IncorrectAud",n.IncorrectIdTokenClaimsAfterRefresh="IncorrectIdTokenClaimsAfterRefresh",n.IncorrectAzp="IncorrectAzp",n.TokenExpired="TokenExpired",n.IncorrectAtHash="IncorrectAtHash",n.Ok="Ok",n.LoginRequired="LoginRequired",n.SecureTokenServerError="SecureTokenServerError",n}(I||{}),ur={userData:null,allUserData:[]},K=(()=>{class n{constructor(){this.userDataInternal$=new oe(ur),this.loggerService=a(v),this.tokenHelperService=a(fe),this.flowHelper=a(U),this.oidcDataService=a(V),this.storagePersistenceService=a(R),this.eventService=a(H)}get userData$(){return this.userDataInternal$.asObservable()}getAndPersistUserDataInStore(e,t,r=!1,i,o){i=i||this.storagePersistenceService.getIdToken(e),o=o||this.tokenHelperService.getPayloadFromToken(i,!1,e);let s=this.getUserDataFromStore(e),c=!!s,l=this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken(e),d=this.flowHelper.isCurrentFlowCodeFlow(e),b=this.storagePersistenceService.getAccessToken(e);if(!(l||d))return this.loggerService.logDebug(e,`authCallback idToken flow with accessToken ${b}`),this.setUserDataToStore(o,e,t),u(o);let{renewUserInfoAfterTokenRenew:S}=e;return!r||S||!c?this.getUserDataOidcFlowAndSave(o.sub,e,t).pipe(D(A=>(this.loggerService.logDebug(e,"Received user data: ",A),A?(this.loggerService.logDebug(e,"accessToken: ",b),u(A)):p(()=>new Error("Received no user data, request failed"))))):u(s)}getUserDataFromStore(e){return e?this.storagePersistenceService.read("userData",e)||null:p(()=>new Error("Please provide a configuration before setting up the module"))}publishUserDataIfExists(e,t){let r=this.getUserDataFromStore(e);r&&this.fireUserDataEvent(e,t,r)}setUserDataToStore(e,t,r){this.storagePersistenceService.write("userData",e,t),this.fireUserDataEvent(t,r,e)}resetUserDataInStore(e,t){this.storagePersistenceService.remove("userData",e),this.fireUserDataEvent(e,t,null)}getUserDataOidcFlowAndSave(e,t,r){return this.getIdentityUserData(t).pipe(g(i=>this.validateUserDataSubIdToken(t,e,i?.sub)?(this.setUserDataToStore(i,t,r),i):(this.loggerService.logWarning(t,"User data sub does not match sub in id_token, resetting"),this.resetUserDataInStore(t,r),null)))}getIdentityUserData(e){let t=this.storagePersistenceService.getAccessToken(e),r=this.storagePersistenceService.read("authWellKnownEndPoints",e);if(!r)return this.loggerService.logWarning(e,"init check session: authWellKnownEndpoints is undefined"),p(()=>new Error("authWellKnownEndpoints is undefined"));let i=r.userInfoEndpoint;return i?this.oidcDataService.get(i,e,t).pipe(N(2)):(this.loggerService.logError(e,"init check session: authWellKnownEndpoints.userinfo_endpoint is undefined; set auto_userinfo = false in config"),p(()=>new Error("authWellKnownEndpoints.userinfo_endpoint is undefined")))}validateUserDataSubIdToken(e,t,r){return!t||!r?!1:t.toString()!==r.toString()?(this.loggerService.logDebug(e,"validateUserDataSubIdToken failed",t,r),!1):!0}fireUserDataEvent(e,t,r){let i=this.composeSingleOrMultipleUserDataObject(e,t,r);this.userDataInternal$.next(i);let{configId:o}=e;this.eventService.fireEvent(E.UserDataChanged,{configId:o,userData:r})}composeSingleOrMultipleUserDataObject(e,t,r){if(!(t.length>1)){let{configId:s}=e;return this.composeSingleUserDataResult(s??"",r)}return{userData:null,allUserData:t.map(s=>{let c=e.configId??"",l=s.configId??"";if(this.currentConfigIsToUpdate(c,s))return{configId:l,userData:r};let d=this.storagePersistenceService.read("userData",s)||null;return{configId:l,userData:d}})}}composeSingleUserDataResult(e,t){return{userData:t,allUserData:[{configId:e,userData:t}]}}currentConfigIsToUpdate(e,t){return t.configId===e}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),W=(()=>{class n{constructor(){this.loggerService=a(v),this.userService=a(K),this.flowsDataService=a(C),this.authStateService=a(M)}resetAuthorizationData(e,t){e&&(this.userService.resetUserDataInStore(e,t),this.flowsDataService.resetStorageFlowData(e),this.authStateService.setUnauthenticatedAndFireEvent(e,t),this.loggerService.logDebug(e,"Local Login information cleaned up and event fired"))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),mr=(()=>{class n{constructor(){this.loggerService=a(v),this.storagePersistenceService=a(R),this.dataService=a(V)}getSigningKeys(e){let r=this.storagePersistenceService.read("authWellKnownEndPoints",e)?.jwksUri;if(!r){let i=`getSigningKeys: authWellKnownEndpoints.jwksUri is: '${r}'`;return this.loggerService.logWarning(e,i),p(()=>new Error(i))}return this.loggerService.logDebug(e,"Getting signinkeys from ",r),this.dataService.get(r,e).pipe(N(2),x(i=>this.handleErrorGetSigningKeys(i,e)))}handleErrorGetSigningKeys(e,t){let r="";if(e instanceof st){let i=e.body||{},o=JSON.stringify(i),{status:s,statusText:c}=e;r=`${s||""} - ${c||""} ${o||""}`}else{let{message:i}=e;r=i||`${e}`}return this.loggerService.logError(t,r),p(()=>new Error(r))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),yt="jwtKeys",hr=(()=>{class n{constructor(){this.loggerService=a(v),this.authStateService=a(M),this.flowsDataService=a(C),this.signInKeyDataService=a(mr),this.storagePersistenceService=a(R),this.resetAuthDataService=a(W),this.document=a(T)}callbackHistoryAndResetJwtKeys(e,t,r){let i=w({},e.authResult);if(!this.responseHasIdToken(e)){let o=this.storagePersistenceService.getIdToken(t);i=ne(w({},i),{id_token:o})}if(this.storagePersistenceService.write("authnResult",i,t),t.allowUnsafeReuseRefreshToken&&e.authResult?.refresh_token&&this.storagePersistenceService.write("reusable_refresh_token",e.authResult.refresh_token,t),this.historyCleanUpTurnedOn(t)&&!e.isRenewProcess?this.resetBrowserHistory():this.loggerService.logDebug(t,"history clean up inactive"),e.authResult?.error){let o=`AuthCallback AuthResult came with error: ${e.authResult.error}`;return this.loggerService.logDebug(t,o),this.resetAuthDataService.resetAuthorizationData(t,r),this.flowsDataService.setNonce("",t),this.handleResultErrorFromCallback(e.authResult,e.isRenewProcess),p(()=>new Error(o))}return this.loggerService.logDebug(t,`AuthResult '${JSON.stringify(e.authResult,null,2)}'.
      AuthCallback created, begin token validation`),this.signInKeyDataService.getSigningKeys(t).pipe(F(o=>this.storeSigningKeys(o,t)),x(o=>{let s=this.readSigningKeys(t);return s?(this.loggerService.logWarning(t,"Failed to retrieve signing keys, fallback to stored keys"),u(s)):p(()=>new Error(o))}),D(o=>{if(o)return e.jwtKeys=o,u(e);let s="Failed to retrieve signing key";return this.loggerService.logWarning(t,s),p(()=>new Error(s))}),x(o=>{let s=`Failed to retrieve signing key with error: ${o}`;return this.loggerService.logWarning(t,s),p(()=>new Error(s))}))}responseHasIdToken(e){return!!e?.authResult?.id_token}handleResultErrorFromCallback(e,t){let r=I.SecureTokenServerError;e&&typeof e=="object"&&"error"in e&&e.error==="login_required"&&(r=I.LoginRequired),this.authStateService.updateAndPublishAuthState({isAuthenticated:!1,validationResult:r,isRenewProcess:t})}historyCleanUpTurnedOn(e){let{historyCleanupOff:t}=e;return!t}resetBrowserHistory(){this.document.defaultView?.history.replaceState({},this.document.title,this.document.defaultView.location.origin+this.document.defaultView.location.pathname)}storeSigningKeys(e,t){this.storagePersistenceService.write(yt,e,t)}readSigningKeys(e){return this.storagePersistenceService.read(yt,e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),pr=(()=>{class n{constructor(){this.loggerService=a(v),this.resetAuthDataService=a(W),this.flowsDataService=a(C),this.document=a(T)}implicitFlowCallback(e,t,r){let i=this.flowsDataService.isSilentRenewRunning(e);this.loggerService.logDebug(e,"BEGIN callback, no auth data"),i||this.resetAuthDataService.resetAuthorizationData(e,t),r=r||this.document.location.hash.substring(1);let s={code:"",refreshToken:"",state:"",sessionState:null,authResult:r.split("&").reduce((c,l)=>{let d=l.split("=");return c[d.shift()]=d.join("="),c},{}),isRenewProcess:i,jwtKeys:null,validationResult:null,existingIdToken:null};return u(s)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),br=(()=>{class n{constructor(){this.loggerService=a(v),this.authStateService=a(M),this.flowsDataService=a(C)}refreshSessionWithRefreshTokens(e){let t=this.flowsDataService.getExistingOrCreateAuthStateControl(e);this.loggerService.logDebug(e,"RefreshSession created. Adding myautostate: "+t);let r=this.authStateService.getRefreshToken(e),i=this.authStateService.getIdToken(e);if(r){let o={code:"",refreshToken:r,state:t,sessionState:null,authResult:null,isRenewProcess:!0,jwtKeys:null,validationResult:null,existingIdToken:i};return this.loggerService.logDebug(e,"found refresh code, obtaining new credentials with refresh code"),this.flowsDataService.setNonce(ve.refreshTokenNoncePlaceholder,e),u(o)}else{let o="no refresh token found, please login";return this.loggerService.logError(e,o),p(()=>new Error(o))}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),fr=(()=>{class n{constructor(){this.urlService=a(_),this.loggerService=a(v),this.dataService=a(V),this.storagePersistenceService=a(R)}refreshTokensRequestTokens(e,t,r){let i=new B;i=i.set("Content-Type","application/x-www-form-urlencoded");let s=this.storagePersistenceService.read("authWellKnownEndPoints",t)?.tokenEndpoint;if(!s)return p(()=>new Error("Token Endpoint not defined"));let c=this.urlService.createBodyForCodeFlowRefreshTokensRequest(e.refreshToken,t,r);return this.dataService.post(s,c,t,i).pipe(D(l=>(this.loggerService.logDebug(t,`token refresh response: ${l}`),l&&(l.state=e.state),e.authResult=l,u(e))),ce(l=>this.handleRefreshRetry(l,t)),x(l=>{let{authority:d}=t,b=`OidcService code request ${d}`;return this.loggerService.logError(t,b,l),p(()=>new Error(b))}))}handleRefreshRetry(e,t){return e.pipe(j(r=>{if(At(r)){let{authority:i,refreshTokenRetryInSeconds:o}=t,s=`OidcService code request ${i} - no internet connection`;return this.loggerService.logWarning(t,s,r),se((o??0)*1e3)}return p(()=>r)}))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),vr=(()=>{class n{isStringEqualOrNonOrderedArrayEqual(e,t){return this.isNullOrUndefined(e)||this.isNullOrUndefined(t)||this.oneValueIsStringAndTheOtherIsArray(e,t)?!1:this.bothValuesAreStrings(e,t)?e===t:this.arraysHaveEqualContent(e,t)}areEqual(e,t){if(!e||!t)return!1;if(this.bothValuesAreArrays(e,t))return this.arraysStrictEqual(e,t);if(this.bothValuesAreStrings(e,t))return e===t;if(this.bothValuesAreObjects(e,t))return JSON.stringify(e).toLowerCase()===JSON.stringify(t).toLowerCase();if(this.oneValueIsStringAndTheOtherIsArray(e,t)){if(Array.isArray(e)&&this.valueIsString(t))return e[0]===t;if(Array.isArray(t)&&this.valueIsString(e))return t[0]===e}return e===t}oneValueIsStringAndTheOtherIsArray(e,t){return Array.isArray(e)&&this.valueIsString(t)||Array.isArray(t)&&this.valueIsString(e)}bothValuesAreObjects(e,t){return this.valueIsObject(e)&&this.valueIsObject(t)}bothValuesAreStrings(e,t){return this.valueIsString(e)&&this.valueIsString(t)}bothValuesAreArrays(e,t){return Array.isArray(e)&&Array.isArray(t)}valueIsString(e){return typeof e=="string"||e instanceof String}valueIsObject(e){return typeof e=="object"}arraysStrictEqual(e,t){if(e.length!==t.length)return!1;for(let r=e.length;r--;)if(e[r]!==t[r])return!1;return!0}arraysHaveEqualContent(e,t){return e.length!==t.length?!1:e.some(r=>t.includes(r))}isNullOrUndefined(e){return e==null}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),be=class{constructor(h="",e="",t=!1,r={at_hash:""},i=I.NotSet){this.accessToken=h,this.idToken=e,this.authResponseIsValid=t,this.decodedIdToken=r,this.state=i}},gr=(()=>{class n{constructor(){this.storagePersistenceService=a(R),this.tokenValidationService=a(ve),this.tokenHelperService=a(fe),this.loggerService=a(v),this.equalityService=a(vr),this.flowHelper=a(U)}getValidatedStateResult(e,t){let r=!!e.authResult?.error;return!!!e||r?u(new be("","",!1,{})):this.validateState(e,t)}validateState(e,t){let r=new be,i=this.storagePersistenceService.read("authStateControl",t);if(!this.tokenValidationService.validateStateFromHashCallback(e.authResult?.state,i,t))return this.loggerService.logWarning(t,"authCallback incorrect state"),r.state=I.StatesDoNotMatch,this.handleUnsuccessfulValidation(t),u(r);let o=this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken(t),s=this.flowHelper.isCurrentFlowCodeFlow(t);if((o||s)&&(r.accessToken=e.authResult?.access_token??""),t.disableIdTokenValidation)return r.state=I.Ok,r.authResponseIsValid=!0,u(r);let l=e.isRenewProcess&&!!e.refreshToken,d=!!e.authResult?.id_token;if(l&&!d)return r.state=I.Ok,r.authResponseIsValid=!0,u(r);if(d){let{clientId:b,issValidationOff:S,maxIdTokenIatOffsetAllowedInSeconds:A,disableIatOffsetValidation:f,ignoreNonceAfterRefresh:O,renewTimeBeforeTokenExpiresInSeconds:P}=t;return r.idToken=e.authResult?.id_token??"",r.decodedIdToken=this.tokenHelperService.getPayloadFromToken(r.idToken,!1,t),this.tokenValidationService.validateSignatureIdToken(r.idToken,e.jwtKeys,t).pipe(j(z=>{if(!z)return this.loggerService.logDebug(t,"authCallback Signature validation failed id_token"),r.state=I.SignatureFailed,this.handleUnsuccessfulValidation(t),u(r);let J=this.storagePersistenceService.read("authNonce",t);if(!this.tokenValidationService.validateIdTokenNonce(r.decodedIdToken,J,!!O,t))return this.loggerService.logWarning(t,"authCallback incorrect nonce, did you call the checkAuth() method multiple times?"),r.state=I.IncorrectNonce,this.handleUnsuccessfulValidation(t),u(r);if(!this.tokenValidationService.validateRequiredIdToken(r.decodedIdToken,t))return this.loggerService.logDebug(t,"authCallback Validation, one of the REQUIRED properties missing from id_token"),r.state=I.RequiredPropertyMissing,this.handleUnsuccessfulValidation(t),u(r);if(!l&&!this.tokenValidationService.validateIdTokenIatMaxOffset(r.decodedIdToken,A??120,!!f,t))return this.loggerService.logWarning(t,"authCallback Validation, iat rejected id_token was issued too far away from the current time"),r.state=I.MaxOffsetExpired,this.handleUnsuccessfulValidation(t),u(r);let k=this.storagePersistenceService.read("authWellKnownEndPoints",t);if(k){if(S)this.loggerService.logDebug(t,"iss validation is turned off, this is not recommended!");else if(!S&&!this.tokenValidationService.validateIdTokenIss(r.decodedIdToken,k.issuer,t))return this.loggerService.logWarning(t,"authCallback incorrect iss does not match authWellKnownEndpoints issuer"),r.state=I.IssDoesNotMatchIssuer,this.handleUnsuccessfulValidation(t),u(r)}else return this.loggerService.logWarning(t,"authWellKnownEndpoints is undefined"),r.state=I.NoAuthWellKnownEndPoints,this.handleUnsuccessfulValidation(t),u(r);return this.tokenValidationService.validateIdTokenAud(r.decodedIdToken,b,t)?this.tokenValidationService.validateIdTokenAzpExistsIfMoreThanOneAud(r.decodedIdToken)?this.tokenValidationService.validateIdTokenAzpValid(r.decodedIdToken,b)?this.isIdTokenAfterRefreshTokenRequestValid(e,r.decodedIdToken,t)?!l&&!this.tokenValidationService.validateIdTokenExpNotExpired(r.decodedIdToken,t,P)?(this.loggerService.logWarning(t,"authCallback id token expired"),r.state=I.TokenExpired,this.handleUnsuccessfulValidation(t),u(r)):this.validateDefault(o,s,r,t,e):(this.loggerService.logWarning(t,"authCallback pre, post id_token claims do not match in refresh"),r.state=I.IncorrectIdTokenClaimsAfterRefresh,this.handleUnsuccessfulValidation(t),u(r)):(this.loggerService.logWarning(t,"authCallback incorrect azp"),r.state=I.IncorrectAzp,this.handleUnsuccessfulValidation(t),u(r)):(this.loggerService.logWarning(t,"authCallback missing azp"),r.state=I.IncorrectAzp,this.handleUnsuccessfulValidation(t),u(r)):(this.loggerService.logWarning(t,"authCallback incorrect aud"),r.state=I.IncorrectAud,this.handleUnsuccessfulValidation(t),u(r))}))}else this.loggerService.logDebug(t,"No id_token found, skipping id_token validation");return this.validateDefault(o,s,r,t,e)}validateDefault(e,t,r,i,o){if(!e&&!t)return r.authResponseIsValid=!0,r.state=I.Ok,this.handleSuccessfulValidation(i),this.handleUnsuccessfulValidation(i),u(r);if(o.authResult?.id_token){let s=this.tokenHelperService.getHeaderFromToken(r.idToken,!1,i);if(t&&!r.decodedIdToken.at_hash)this.loggerService.logDebug(i,"Code Flow active, and no at_hash in the id_token, skipping check!");else return this.tokenValidationService.validateIdTokenAtHash(r.accessToken,r.decodedIdToken.at_hash,s.alg,i).pipe(g(c=>!c||!r.accessToken?(this.loggerService.logWarning(i,"authCallback incorrect at_hash"),r.state=I.IncorrectAtHash,this.handleUnsuccessfulValidation(i),r):(r.authResponseIsValid=!0,r.state=I.Ok,this.handleSuccessfulValidation(i),r)))}return r.authResponseIsValid=!0,r.state=I.Ok,this.handleSuccessfulValidation(i),u(r)}isIdTokenAfterRefreshTokenRequestValid(e,t,r){let{useRefreshToken:i,disableRefreshIdTokenAuthTimeValidation:o}=r;if(!i||!e.existingIdToken)return!0;let s=this.tokenHelperService.getPayloadFromToken(e.existingIdToken,!1,r);return s.iss!==t.iss?(this.loggerService.logDebug(r,`iss do not match: ${s.iss} ${t.iss}`),!1):s.azp!==t.azp?(this.loggerService.logDebug(r,`azp do not match: ${s.azp} ${t.azp}`),!1):s.sub!==t.sub?(this.loggerService.logDebug(r,`sub do not match: ${s.sub} ${t.sub}`),!1):this.equalityService.isStringEqualOrNonOrderedArrayEqual(s?.aud,t?.aud)?o?!0:s.auth_time!==t.auth_time?(this.loggerService.logDebug(r,`auth_time do not match: ${s.auth_time} ${t.auth_time}`),!1):!0:(this.loggerService.logDebug(r,`aud in new id_token is not valid: '${s?.aud}' '${t.aud}'`),!1)}handleSuccessfulValidation(e){let{autoCleanStateAfterAuthentication:t}=e;this.storagePersistenceService.write("authNonce",null,e),t&&this.storagePersistenceService.write("authStateControl","",e),this.loggerService.logDebug(e,"authCallback token(s) validated, continue")}handleUnsuccessfulValidation(e){let{autoCleanStateAfterAuthentication:t}=e;this.storagePersistenceService.write("authNonce",null,e),t&&this.storagePersistenceService.write("authStateControl","",e),this.loggerService.logDebug(e,"authCallback token(s) invalid")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Sr=(()=>{class n{constructor(){this.loggerService=a(v),this.stateValidationService=a(gr),this.authStateService=a(M),this.resetAuthDataService=a(W),this.document=a(T)}callbackStateValidation(e,t,r){return this.stateValidationService.getValidatedStateResult(e,t).pipe(g(i=>{if(e.validationResult=i,i.authResponseIsValid)return this.authStateService.setAuthorizationData(i.accessToken,e.authResult,t,r),e;{let o=`authorizedCallback, token(s) validation failed, resetting. Hash: ${this.document.location.hash}`;throw this.loggerService.logWarning(t,o),this.resetAuthDataService.resetAuthorizationData(t,r),this.publishUnauthorizedState(e.validationResult,e.isRenewProcess),new Error(o)}}))}publishUnauthorizedState(e,t){this.authStateService.updateAndPublishAuthState({isAuthenticated:!1,validationResult:e.state,isRenewProcess:t})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),yr=(()=>{class n{constructor(){this.loggerService=a(v),this.authStateService=a(M),this.flowsDataService=a(C),this.userService=a(K),this.resetAuthDataService=a(W)}callbackUser(e,t,r){let{isRenewProcess:i,validationResult:o,authResult:s,refreshToken:c}=e,{autoUserInfo:l,renewUserInfoAfterTokenRenew:d}=t;return l?this.userService.getAndPersistUserDataInStore(t,r,i,o?.idToken,o?.decodedIdToken).pipe(D(b=>{if(b)return c||this.flowsDataService.setSessionState(s?.session_state,t),this.publishAuthState(o,i),u(e);{this.resetAuthDataService.resetAuthorizationData(t,r),this.publishUnauthenticatedState(o,i);let S=`Called for userData but they were ${b}`;return this.loggerService.logWarning(t,S),p(()=>new Error(S))}}),x(b=>{let S=`Failed to retrieve user info with error:  ${b}`;return this.loggerService.logWarning(t,S),p(()=>new Error(S))})):((!i||d)&&o?.decodedIdToken&&this.userService.setUserDataToStore(o.decodedIdToken,t,r),!i&&!c&&this.flowsDataService.setSessionState(s?.session_state,t),this.publishAuthState(o,i),u(e))}publishAuthState(e,t){e&&this.authStateService.updateAndPublishAuthState({isAuthenticated:!0,validationResult:e.state,isRenewProcess:t})}publishUnauthenticatedState(e,t){e&&this.authStateService.updateAndPublishAuthState({isAuthenticated:!1,validationResult:e.state,isRenewProcess:t})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ge=(()=>{class n{constructor(){this.codeFlowCallbackHandlerService=a(dr),this.implicitFlowCallbackHandlerService=a(pr),this.historyJwtKeysCallbackHandlerService=a(hr),this.userHandlerService=a(yr),this.stateValidationCallbackHandlerService=a(Sr),this.refreshSessionCallbackHandlerService=a(br),this.refreshTokenCallbackHandlerService=a(fr)}processCodeFlowCallback(e,t,r){return this.codeFlowCallbackHandlerService.codeFlowCallback(e,t).pipe(y(i=>this.codeFlowCallbackHandlerService.codeFlowCodeRequest(i,t)),y(i=>this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(i,t,r)),y(i=>this.stateValidationCallbackHandlerService.callbackStateValidation(i,t,r)),y(i=>this.userHandlerService.callbackUser(i,t,r)))}processSilentRenewCodeFlowCallback(e,t,r){return this.codeFlowCallbackHandlerService.codeFlowCodeRequest(e,t).pipe(y(i=>this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(i,t,r)),y(i=>this.stateValidationCallbackHandlerService.callbackStateValidation(i,t,r)),y(i=>this.userHandlerService.callbackUser(i,t,r)))}processImplicitFlowCallback(e,t,r){return this.implicitFlowCallbackHandlerService.implicitFlowCallback(e,t,r).pipe(y(i=>this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(i,e,t)),y(i=>this.stateValidationCallbackHandlerService.callbackStateValidation(i,e,t)),y(i=>this.userHandlerService.callbackUser(i,e,t)))}processRefreshToken(e,t,r){return this.refreshSessionCallbackHandlerService.refreshSessionWithRefreshTokens(e).pipe(y(i=>this.refreshTokenCallbackHandlerService.refreshTokensRequestTokens(i,e,r)),y(i=>this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(i,e,t)),y(i=>this.stateValidationCallbackHandlerService.callbackStateValidation(i,e,t)),y(i=>this.userHandlerService.callbackUser(i,e,t)))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),re=(()=>{class n{constructor(){this.zone=a(Q),this.document=a(T),this.runTokenValidationRunning=null}isTokenValidationRunning(){return!!this.runTokenValidationRunning}stopPeriodicTokenCheck(){this.runTokenValidationRunning&&(this.runTokenValidationRunning.unsubscribe(),this.runTokenValidationRunning=null)}startPeriodicTokenCheck(e){let t=e*1e3;return new G(r=>{let i;return this.zone.runOutsideAngular(()=>{i=this.document?.defaultView?.setInterval(()=>this.zone.run(()=>r.next()),t)}),()=>{clearInterval(i)}})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),wr=(()=>{class n{constructor(){this.flowsService=a(ge),this.router=a(me),this.flowsDataService=a(C),this.intervalService=a(re)}authenticatedCallbackWithCode(e,t,r){let i=this.flowsDataService.isSilentRenewRunning(t),{triggerAuthorizationResultEvent:o}=t,s=t.postLoginRoute||"/",c=t.unauthorizedRoute||"/";return this.flowsService.processCodeFlowCallback(e,t,r).pipe(F(l=>{this.flowsDataService.resetCodeFlowInProgress(t),!o&&!l.isRenewProcess&&this.router.navigateByUrl(s)}),x(l=>(this.flowsDataService.resetSilentRenewRunning(t),this.flowsDataService.resetCodeFlowInProgress(t),this.intervalService.stopPeriodicTokenCheck(),!o&&!i&&this.router.navigateByUrl(c),p(()=>new Error(l)))))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Et=(()=>{class n{constructor(){this.flowsService=a(ge),this.router=a(me),this.flowsDataService=a(C),this.intervalService=a(re)}authenticatedImplicitFlowCallback(e,t,r){let i=this.flowsDataService.isSilentRenewRunning(e),o=!!e.triggerAuthorizationResultEvent,s=e.postLoginRoute??"",c=e.unauthorizedRoute??"";return this.flowsService.processImplicitFlowCallback(e,t,r).pipe(F(l=>{!o&&!l.isRenewProcess&&this.router.navigateByUrl(s)}),x(l=>(this.flowsDataService.resetSilentRenewRunning(e),this.intervalService.stopPeriodicTokenCheck(),!o&&!i&&this.router.navigateByUrl(c),p(()=>new Error(l)))))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ct=(()=>{class n{constructor(){this.urlService=a(_),this.flowHelper=a(U),this.implicitFlowCallbackService=a(Et),this.codeFlowCallbackService=a(wr),this.stsCallbackInternal$=new ie}get stsCallback$(){return this.stsCallbackInternal$.asObservable()}isCallback(e,t){return e?this.urlService.isCallbackFromSts(e,t):!1}handleCallbackAndFireEvents(e,t,r){let i=new G;if(this.flowHelper.isCurrentFlowCodeFlow(t))i=this.codeFlowCallbackService.authenticatedCallbackWithCode(e,t,r);else if(this.flowHelper.isCurrentFlowAnyImplicitFlow(t))if(e?.includes("#")){let o=e.substring(e.indexOf("#")+1);i=this.implicitFlowCallbackService.authenticatedImplicitFlowCallback(t,r,o)}else i=this.implicitFlowCallbackService.authenticatedImplicitFlowCallback(t,r);return i.pipe(F(()=>this.stsCallbackInternal$.next()))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),kr=(()=>{class n{constructor(){this.platformId=a(Qe)}isBrowser(){return at(this.platformId)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ir="/.well-known/openid-configuration",Dr=(()=>{class n{constructor(){this.loggerService=a(v),this.http=a(V)}getWellKnownEndPointsForConfig(e){let{authWellknownEndpointUrl:t,authWellknownEndpoints:r={}}=e;if(!t){let i="no authWellknownEndpoint given!";return this.loggerService.logError(e,i),p(()=>new Error(i))}return this.getWellKnownDocument(t,e).pipe(g(i=>({issuer:i.issuer,jwksUri:i.jwks_uri,authorizationEndpoint:i.authorization_endpoint,tokenEndpoint:i.token_endpoint,userInfoEndpoint:i.userinfo_endpoint,endSessionEndpoint:i.end_session_endpoint,checkSessionIframe:i.check_session_iframe,revocationEndpoint:i.revocation_endpoint,introspectionEndpoint:i.introspection_endpoint,parEndpoint:i.pushed_authorization_request_endpoint})),g(i=>w(w({},i),r)))}getWellKnownDocument(e,t){let r=e,i=t.authWellknownUrlSuffix||Ir;return e.includes(i)||(r=`${e}${i}`),this.http.get(r,t).pipe(N(2))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),L=(()=>{class n{constructor(){this.dataService=a(Dr),this.publicEventsService=a(H),this.storagePersistenceService=a(R)}storeWellKnownEndpoints(e,t){this.storagePersistenceService.write("authWellKnownEndPoints",t,e)}queryAndStoreAuthWellKnownEndPoints(e){return e?this.dataService.getWellKnownEndPointsForConfig(e).pipe(F(t=>this.storeWellKnownEndpoints(e,t)),x(t=>(this.publicEventsService.fireEvent(E.ConfigLoadingFailed,null),p(()=>new Error(t))))):p(()=>new Error("Please provide a configuration before setting up the module"))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Rr={authority:"https://please_set",authWellknownEndpointUrl:"",authWellknownEndpoints:void 0,redirectUrl:"https://please_set",checkRedirectUrlWhenCheckingIfIsCallback:!0,clientId:"please_set",responseType:"code",scope:"openid email profile",hdParam:"",postLogoutRedirectUri:"https://please_set",startCheckSession:!1,silentRenew:!1,silentRenewUrl:"https://please_set",silentRenewTimeoutInSeconds:20,renewTimeBeforeTokenExpiresInSeconds:0,useRefreshToken:!1,usePushedAuthorisationRequests:!1,ignoreNonceAfterRefresh:!1,postLoginRoute:"/",forbiddenRoute:"/forbidden",unauthorizedRoute:"/unauthorized",autoUserInfo:!0,autoCleanStateAfterAuthentication:!0,triggerAuthorizationResultEvent:!1,logLevel:te.Warn,issValidationOff:!1,historyCleanupOff:!1,maxIdTokenIatOffsetAllowedInSeconds:120,disableIatOffsetValidation:!1,customParamsAuthRequest:{},customParamsRefreshTokenRequest:{},customParamsEndSessionRequest:{},customParamsCodeRequest:{},disableRefreshIdTokenAuthTimeValidation:!1,triggerRefreshWhenIdTokenExpired:!0,tokenRefreshInSeconds:4,refreshTokenRetryInSeconds:3,ngswBypass:!1},q={result:!0,messages:[],level:"none"},xr=n=>n.authority?q:{result:!1,messages:["The authority URL MUST be provided in the configuration! "],level:"error"},Ar=n=>n.clientId?q:{result:!1,messages:["The clientId is required and missing from your config!"],level:"error"},Er=n=>{if(!n)return"";let{authority:h,clientId:e,scope:t}=n;return`${h}${e}${t}`},Cr=n=>new Set(n).size!==n.length,Tr=n=>{let h=n.map(r=>Er(r));return h.some(r=>r==="")?{result:!1,messages:["Please make sure you add an object with a 'config' property: ....({ config }) instead of ...(config)"],level:"error"}:Cr(h)?{result:!1,messages:["You added multiple configs with the same authority, clientId and scope"],level:"warning"}:q},Pr=n=>n.redirectUrl?q:{result:!1,messages:["The redirectUrl is required and missing from your config"],level:"error"},Fr=n=>{let h=n.silentRenew,e=n.useRefreshToken,t=n.silentRenewUrl;return h&&!e&&!t?{result:!1,messages:["Please provide a silent renew URL if using renew and not refresh tokens"],level:"error"}:q},Mr=n=>{let h=n.useRefreshToken,e=n.silentRenew,r=(n.scope||"").split(" ").includes("offline_access");return h&&e&&!r?{result:!1,messages:["When using silent renew and refresh tokens please set the `offline_access` scope"],level:"warning"}:q},_r=[xr,Mr,Pr,Ar,Fr],Ur=[Tr],Wr=(()=>{class n{constructor(){this.loggerService=a(v)}validateConfigs(e){return this.validateConfigsInternal(e??[],Ur)}validateConfig(e){return this.validateConfigInternal(e,_r)}validateConfigsInternal(e,t){if(e.length===0)return!1;let r=t.map(o=>o(e)),i=0;return e.forEach(o=>{let s=this.processValidationResultsAndGetErrorCount(r,o);i+=s}),i===0}validateConfigInternal(e,t){let r=t.map(o=>o(e));return this.processValidationResultsAndGetErrorCount(r,e)===0}processValidationResultsAndGetErrorCount(e,t){let r=e.filter(s=>s.messages.length>0),i=this.getAllMessagesOfType("error",r),o=this.getAllMessagesOfType("warning",r);return i.forEach(s=>this.loggerService.logError(t,s)),o.forEach(s=>this.loggerService.logWarning(t,s)),i.length}getAllMessagesOfType(e,t){return t.filter(i=>i.level===e).map(i=>i.messages).reduce((i,o)=>i.concat(o),[])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Tt=(()=>{class n{constructor(){this.loggerService=a(v),this.publicEventsService=a(H),this.storagePersistenceService=a(R),this.platformProvider=a(kr),this.authWellKnownService=a(L),this.loader=a(pe),this.configValidationService=a(Wr),this.configsInternal={}}hasManyConfigs(){return Object.keys(this.configsInternal).length>1}getAllConfigurations(){return Object.values(this.configsInternal)}getOpenIDConfiguration(e){return this.configsAlreadySaved()?u(this.getConfig(e)):this.getOpenIDConfigurations(e).pipe(g(t=>t.currentConfig))}getOpenIDConfigurations(e){return this.loadConfigs().pipe(y(t=>this.prepareAndSaveConfigs(t)),g(t=>({allConfigs:t,currentConfig:this.getConfig(e)})))}hasAtLeastOneConfig(){return Object.keys(this.configsInternal).length>0}saveConfig(e){let{configId:t}=e;this.configsInternal[t]=e}loadConfigs(){return this.loader.loadConfigs()}configsAlreadySaved(){return this.hasAtLeastOneConfig()}getConfig(e){if(e){let r=this.configsInternal[e];return!r&&it()&&console.warn(`[angular-auth-oidc-client] No configuration found for config id '${e}'.`),r||null}let[,t]=Object.entries(this.configsInternal)[0]||[[null,null]];return t||null}prepareAndSaveConfigs(e){if(!this.configValidationService.validateConfigs(e))return u([]);this.createUniqueIds(e);let t=e.map(i=>this.handleConfig(i));return $(t).pipe(g(i=>i.filter(o=>!!o)),g(i=>i))}createUniqueIds(e){e.forEach((t,r)=>{t.configId||(t.configId=`${r}-${t.clientId}`)})}handleConfig(e){if(!this.configValidationService.validateConfig(e))return this.loggerService.logError(e,"Validation of config rejected with errors. Config is NOT set."),u(null);e.authWellknownEndpointUrl||(e.authWellknownEndpointUrl=e.authority);let t=this.prepareConfig(e);this.saveConfig(t);let r=this.enhanceConfigWithWellKnownEndpoint(t);return this.publicEventsService.fireEvent(E.ConfigLoaded,r),u(t)}enhanceConfigWithWellKnownEndpoint(e){let t=this.storagePersistenceService.read("authWellKnownEndPoints",e);if(t)return e.authWellknownEndpoints=t,e;let r=e.authWellknownEndpoints;return r&&(this.authWellKnownService.storeWellKnownEndpoints(e,r),e.authWellknownEndpoints=r),e}prepareConfig(e){let t=w(w({},Rr),e);return this.setSpecialCases(t),t}setSpecialCases(e){this.platformProvider.isBrowser()||(e.startCheckSession=!1,e.silentRenew=!1,e.useRefreshToken=!1,e.usePushedAuthorisationRequests=!1)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Pt=(()=>{class n{constructor(){this.document=a(T),this.loggerService=a(v)}getExistingIFrame(e){let t=this.getIFrameFromParentWindow(e);if(this.isIFrameElement(t))return t;let r=this.getIFrameFromWindow(e);return this.isIFrameElement(r)?r:null}addIFrameToWindowBody(e,t){let r=this.document.createElement("iframe");return r.id=e,r.title=e,this.loggerService.logDebug(t,r),r.style.display="none",this.document.body.appendChild(r),r}getIFrameFromParentWindow(e){try{let t=this.document.defaultView?.parent.document.getElementById(e);return this.isIFrameElement(t)?t:null}catch{return null}}getIFrameFromWindow(e){let t=this.document.getElementById(e);return this.isIFrameElement(t)?t:null}isIFrameElement(e){return!!e&&e instanceof HTMLIFrameElement}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),wt="myiFrameForSilentRenew",We=(()=>{class n{constructor(){this.refreshSessionWithIFrameCompletedInternal$=new ie,this.loggerService=a(v),this.iFrameService=a(Pt),this.flowsService=a(ge),this.resetAuthDataService=a(W),this.flowsDataService=a(C),this.authStateService=a(M),this.flowHelper=a(U),this.implicitFlowCallbackService=a(Et),this.intervalService=a(re)}get refreshSessionWithIFrameCompleted$(){return this.refreshSessionWithIFrameCompletedInternal$.asObservable()}getOrCreateIframe(e){let t=this.getExistingIframe();return t||this.iFrameService.addIFrameToWindowBody(wt,e)}isSilentRenewConfigured(e){let{useRefreshToken:t,silentRenew:r}=e;return!t&&!!r}codeFlowCallbackSilentRenewIframe(e,t,r){let i=new ue({fromString:e[1]}),o=i.get("error");if(o)return this.authStateService.updateAndPublishAuthState({isAuthenticated:!1,validationResult:I.LoginRequired,isRenewProcess:!0}),this.resetAuthDataService.resetAuthorizationData(t,r),this.flowsDataService.setNonce("",t),this.intervalService.stopPeriodicTokenCheck(),p(()=>new Error(o));let s=i.get("code")??"",c=i.get("state")??"",l=i.get("session_state"),d={code:s,refreshToken:"",state:c,sessionState:l,authResult:null,isRenewProcess:!0,jwtKeys:null,validationResult:null,existingIdToken:null};return this.flowsService.processSilentRenewCodeFlowCallback(d,t,r).pipe(x(b=>(this.intervalService.stopPeriodicTokenCheck(),this.resetAuthDataService.resetAuthorizationData(t,r),p(()=>new Error(b)))))}silentRenewEventHandler(e,t,r){if(this.loggerService.logDebug(t,"silentRenewEventHandler"),!e.detail)return;let i;if(this.flowHelper.isCurrentFlowCodeFlow(t)){let s=e.detail.toString().split("?");i=this.codeFlowCallbackSilentRenewIframe(s,t,r)}else i=this.implicitFlowCallbackService.authenticatedImplicitFlowCallback(t,r,e.detail);i.subscribe({next:s=>{this.refreshSessionWithIFrameCompletedInternal$.next(s),this.flowsDataService.resetSilentRenewRunning(t)},error:s=>{this.loggerService.logError(t,"Error: "+s),this.refreshSessionWithIFrameCompletedInternal$.next(null),this.flowsDataService.resetSilentRenewRunning(t)}})}getExistingIframe(){return this.iFrameService.getExistingIFrame(wt)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ft=(()=>{class n{constructor(){this.renderer=a(Xe).createRenderer(null,null),this.loggerService=a(v),this.urlService=a(_),this.silentRenewService=a(We),this.document=a(T)}refreshSessionWithIframe(e,t,r){return this.loggerService.logDebug(e,"BEGIN refresh session Authorize Iframe renew"),this.urlService.getRefreshSessionSilentRenewUrl(e,r).pipe(D(i=>this.sendAuthorizeRequestUsingSilentRenew(i,e,t)))}sendAuthorizeRequestUsingSilentRenew(e,t,r){let i=this.silentRenewService.getOrCreateIframe(t);return this.initSilentRenewRequest(t,r),this.loggerService.logDebug(t,`sendAuthorizeRequestUsingSilentRenew for URL: ${e}`),new G(o=>{let s=()=>{i.removeEventListener("load",s),this.loggerService.logDebug(t,"removed event listener from IFrame"),o.next(!0),o.complete()};i.addEventListener("load",s),i.contentWindow?.location.replace(e??"")})}initSilentRenewRequest(e,t){let r=Math.random(),i=this.renderer.listen("window","oidc-silent-renew-init",s=>{s.detail!==r&&(i(),o())}),o=this.renderer.listen("window","oidc-silent-renew-message",s=>this.silentRenewService.silentRenewEventHandler(s,e,t));this.document.defaultView?.dispatchEvent(new CustomEvent("oidc-silent-renew-init",{detail:r}))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Mt=(()=>{class n{constructor(){this.loggerService=a(v),this.resetAuthDataService=a(W),this.flowsService=a(ge),this.intervalService=a(re)}refreshSessionWithRefreshTokens(e,t,r){this.loggerService.logDebug(e,"BEGIN refresh session Authorize");let i=!1;return this.flowsService.processRefreshToken(e,t,r).pipe(x(o=>(this.resetAuthDataService.resetAuthorizationData(e,t),i=!0,p(()=>new Error(o)))),Le(()=>i&&this.intervalService.stopPeriodicTokenCheck()))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Or=(()=>{class n{constructor(){this.resetAuthDataService=a(W),this.flowHelper=a(U),this.flowsDataService=a(C),this.loggerService=a(v),this.userService=a(K),this.authStateService=a(M),this.refreshSessionIframeService=a(Ft),this.refreshSessionRefreshTokenService=a(Mt),this.intervalService=a(re),this.storagePersistenceService=a(R),this.publicEventsService=a(H),this.configurationService=a(Tt)}startTokenValidationPeriodically(e,t){let r=this.getConfigsWithSilentRenewEnabled(e);if(r.length<=0||this.intervalService.isTokenValidationRunning())return;let i=this.getSmallestRefreshTimeFromConfigs(r),o=this.intervalService.startPeriodicTokenCheck(i).pipe(D(()=>{let s={};return r.forEach(c=>{let l=c.configId,d=this.getRefreshEvent(c,e);s[l]=d}),$(s)}));this.intervalService.runTokenValidationRunning=o.pipe(x(s=>p(()=>new Error(s)))).subscribe({next:s=>{for(let[c,l]of Object.entries(s))this.configurationService.getOpenIDConfiguration(c).subscribe(d=>{this.loggerService.logDebug(d,"silent renew, periodic check finished!"),this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens(d)&&this.flowsDataService.resetSilentRenewRunning(d)})},error:s=>{this.loggerService.logError(t,"silent renew failed!",s)}})}getRefreshEvent(e,t){if(!this.shouldStartPeriodicallyCheckForConfig(e))return u(null);let i=this.createRefreshEventForConfig(e,t);return this.publicEventsService.fireEvent(E.SilentRenewStarted),i.pipe(x(o=>(this.loggerService.logError(e,"silent renew failed!",o),this.publicEventsService.fireEvent(E.SilentRenewFailed,o),this.flowsDataService.resetSilentRenewRunning(e),p(()=>new Error(o)))))}getSmallestRefreshTimeFromConfigs(e){return e.reduce((r,i)=>(r.tokenRefreshInSeconds??0)<(i.tokenRefreshInSeconds??0)?r:i).tokenRefreshInSeconds??0}getConfigsWithSilentRenewEnabled(e){return e.filter(t=>t.silentRenew)}createRefreshEventForConfig(e,t){return this.loggerService.logDebug(e,"starting silent renew..."),this.configurationService.getOpenIDConfiguration(e.configId).pipe(D(r=>{if(!r?.silentRenew)return this.resetAuthDataService.resetAuthorizationData(r,t),u(null);if(this.flowsDataService.setSilentRenewRunning(r),this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens(r)){let o=this.storagePersistenceService.read("storageCustomParamsRefresh",r)||{},{customParamsRefreshTokenRequest:s}=r,c=w(w({},s),o);return this.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(r,t,c)}let i=this.storagePersistenceService.read("storageCustomParamsAuthRequest",r);return this.refreshSessionIframeService.refreshSessionWithIframe(r,t,i)}))}shouldStartPeriodicallyCheckForConfig(e){let t=this.authStateService.getIdToken(e),r=this.flowsDataService.isSilentRenewRunning(e),i=this.flowsDataService.isCodeFlowInProgress(e),o=this.userService.getUserDataFromStore(e);if(this.loggerService.logDebug(e,`Checking: silentRenewRunning: ${r}, isCodeFlowInProgress: ${i} - has idToken: ${!!t} - has userData: ${!!o}`),!(!!o&&!r&&!!t&&!i))return!1;let c=this.authStateService.hasIdTokenExpiredAndRenewCheckIsEnabled(e),l=this.authStateService.hasAccessTokenExpiredIfExpiryExists(e);return c||l}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),zr=3,_t=(()=>{class n{constructor(){this.flowHelper=a(U),this.flowsDataService=a(C),this.loggerService=a(v),this.silentRenewService=a(We),this.authStateService=a(M),this.authWellKnownService=a(L),this.refreshSessionIframeService=a(Ft),this.storagePersistenceService=a(R),this.refreshSessionRefreshTokenService=a(Mt),this.userService=a(K)}userForceRefreshSession(e,t,r){return e?(this.persistCustomParams(r,e),this.forceRefreshSession(e,t,r).pipe(F(()=>this.flowsDataService.resetSilentRenewRunning(e)))):p(()=>new Error("Please provide a configuration before setting up the module"))}forceRefreshSession(e,t,r){let{customParamsRefreshTokenRequest:i,configId:o}=e,s=w(w({},i),r);if(this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens(e))return this.startRefreshSession(e,t,s).pipe(g(()=>{let d=this.authStateService.areAuthStorageTokensValid(e);return d?{idToken:this.authStateService.getIdToken(e),accessToken:this.authStateService.getAccessToken(e),userData:this.userService.getUserDataFromStore(e),isAuthenticated:d,configId:o}:{isAuthenticated:!1,errorMessage:"",userData:null,idToken:"",accessToken:"",configId:o}}));let{silentRenewTimeoutInSeconds:c}=e,l=(c??0)*1e3;return $([this.startRefreshSession(e,t,r),this.silentRenewService.refreshSessionWithIFrameCompleted$.pipe(Y(1))]).pipe(Be(l),ce(d=>d.pipe(j((b,S)=>{let f=S+1;return!(b instanceof Ne)||f>zr?p(()=>new Error(b)):(this.loggerService.logDebug(e,`forceRefreshSession timeout. Attempt #${f}`),this.flowsDataService.resetSilentRenewRunning(e),se(f*1e3))}))),g(([d,b])=>{let S=this.authStateService.areAuthStorageTokensValid(e);return S?{idToken:b?.authResult?.id_token??"",accessToken:b?.authResult?.access_token??"",userData:this.userService.getUserDataFromStore(e),isAuthenticated:S,configId:o}:{isAuthenticated:!1,errorMessage:"",userData:null,idToken:"",accessToken:"",configId:o}}))}persistCustomParams(e,t){let{useRefreshToken:r}=t;e&&(r?this.storagePersistenceService.write("storageCustomParamsRefresh",e,t):this.storagePersistenceService.write("storageCustomParamsAuthRequest",e,t))}startRefreshSession(e,t,r){let i=this.flowsDataService.isSilentRenewRunning(e);return this.loggerService.logDebug(e,`Checking: silentRenewRunning: ${i}`),!i?this.authWellKnownService.queryAndStoreAuthWellKnownEndPoints(e).pipe(D(()=>(this.flowsDataService.setSilentRenewRunning(e),this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens(e)?this.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(e,t,r):this.refreshSessionIframeService.refreshSessionWithIframe(e,t,r)))):u(null)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),kt="myiFrameForCheckSession",Oe=(()=>{class n{constructor(){this.loggerService=a(v),this.storagePersistenceService=a(R),this.iFrameService=a(Pt),this.eventService=a(H),this.zone=a(Q),this.document=a(T),this.checkSessionReceived=!1,this.scheduledHeartBeatRunning=null,this.lastIFrameRefresh=0,this.outstandingMessages=0,this.heartBeatInterval=3e3,this.iframeRefreshInterval=6e4,this.checkSessionChangedInternal$=new oe(!1)}get checkSessionChanged$(){return this.checkSessionChangedInternal$.asObservable()}ngOnDestroy(){this.stop();let e=this.document.defaultView;e&&this.iframeMessageEventListener&&e.removeEventListener("message",this.iframeMessageEventListener,!1)}isCheckSessionConfigured(e){let{startCheckSession:t}=e;return!!t}start(e){if(this.scheduledHeartBeatRunning)return;let{clientId:t}=e;this.pollServerSession(t,e)}stop(){this.scheduledHeartBeatRunning&&(this.clearScheduledHeartBeat(),this.checkSessionReceived=!1)}serverStateChanged(e){let{startCheckSession:t}=e;return!!t&&this.checkSessionReceived}getExistingIframe(){return this.iFrameService.getExistingIFrame(kt)}init(e){if(this.lastIFrameRefresh+this.iframeRefreshInterval>Date.now())return u();let t=this.storagePersistenceService.read("authWellKnownEndPoints",e);if(!t)return this.loggerService.logWarning(e,"CheckSession - init check session: authWellKnownEndpoints is undefined. Returning."),u();let r=this.getOrCreateIframe(e);this.bindMessageEventToIframe(e);let i=t.checkSessionIframe,o=r.contentWindow;return i?(o?o.location.replace(i):this.loggerService.logWarning(e,"CheckSession - init check session: IFrame contentWindow does not exist"),new G(s=>{r.onload=()=>{this.lastIFrameRefresh=Date.now(),s.next(),s.complete()}})):(this.loggerService.logWarning(e,"CheckSession - init check session: checkSessionIframe is not configured to run"),u())}pollServerSession(e,t){this.outstandingMessages=0;let r=()=>{this.init(t).pipe(Y(1)).subscribe(()=>{let i=this.getExistingIframe();if(i&&e){this.loggerService.logDebug(t,`CheckSession - clientId : '${e}' - existingIframe: '${i}'`);let o=this.storagePersistenceService.read("session_state",t),s=this.storagePersistenceService.read("authWellKnownEndPoints",t),c=i.contentWindow;if(o&&s?.checkSessionIframe&&c){let l=new URL(s.checkSessionIframe)?.origin;this.outstandingMessages++,c.postMessage(e+" "+o,l)}else this.loggerService.logDebug(t,`CheckSession - session_state is '${o}' - AuthWellKnownEndPoints is '${JSON.stringify(s,null,2)}'`),this.checkSessionChangedInternal$.next(!0)}else this.loggerService.logWarning(t,`CheckSession - OidcSecurityCheckSession pollServerSession checkSession IFrame does not exist:
               clientId : '${e}' - existingIframe: '${i}'`);this.outstandingMessages>3&&this.loggerService.logError(t,`CheckSession - OidcSecurityCheckSession not receiving check session response messages.
                            Outstanding messages: '${this.outstandingMessages}'. Server unreachable?`),this.zone.runOutsideAngular(()=>{this.scheduledHeartBeatRunning=this.document?.defaultView?.setTimeout(()=>this.zone.run(r),this.heartBeatInterval)??null})})};r()}clearScheduledHeartBeat(){this.scheduledHeartBeatRunning!==null&&(clearTimeout(this.scheduledHeartBeatRunning),this.scheduledHeartBeatRunning=null)}messageHandler(e,t){let r=this.getExistingIframe(),o=!!this.storagePersistenceService.read("authWellKnownEndPoints",e)?.checkSessionIframe?.startsWith(t.origin);this.outstandingMessages=0,r&&o&&t.source===r.contentWindow&&(t.data==="error"?this.loggerService.logWarning(e,"CheckSession - error from check session messageHandler"):t.data==="changed"?(this.loggerService.logDebug(e,`CheckSession - ${t} from check session messageHandler`),this.checkSessionReceived=!0,this.eventService.fireEvent(E.CheckSessionReceived,t.data),this.checkSessionChangedInternal$.next(!0)):(this.eventService.fireEvent(E.CheckSessionReceived,t.data),this.loggerService.logDebug(e,`CheckSession - ${t.data} from check session messageHandler`)))}bindMessageEventToIframe(e){this.iframeMessageEventListener=this.messageHandler.bind(this,e);let t=this.document.defaultView;t&&t.addEventListener("message",this.iframeMessageEventListener,!1)}getOrCreateIframe(e){return this.getExistingIframe()||this.iFrameService.addIFrameToWindowBody(kt,e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Se=(()=>{class n{constructor(){this.loggerService=a(v),this.storagePersistenceService=a(R),this.document=a(T),this.STORAGE_IDENTIFIER="popupauth",this.popUp=null,this.handle=-1,this.resultInternal$=new ie}get result$(){return this.resultInternal$.asObservable()}get windowInternal(){return this.document.defaultView}isCurrentlyInPopup(e){if(this.canAccessSessionStorage()){let t=this.storagePersistenceService.read(this.STORAGE_IDENTIFIER,e),r=this.windowInternal;return r?!!r.opener&&r.opener!==r&&!!t:!1}return!1}openPopUp(e,t,r){let i=this.getOptions(t);this.storagePersistenceService.write(this.STORAGE_IDENTIFIER,"true",r);let o=this.windowInternal;if(!o)return;if(!e){this.loggerService.logError(r,"Could not open popup, url is empty");return}if(this.popUp=o.open(e,"_blank",i),!this.popUp){this.storagePersistenceService.remove(this.STORAGE_IDENTIFIER,r),this.loggerService.logError(r,"Could not open popup");return}this.loggerService.logDebug(r,"Opened popup with url "+e);let s=c=>{if(!c?.data||typeof c.data!="string"){if(r.disableCleaningPopupOnInvalidMessage)return;this.cleanUp(s,r);return}this.loggerService.logDebug(r,"Received message from popup with url "+c.data),this.resultInternal$.next({userClosed:!1,receivedUrl:c.data}),this.cleanUp(s,r)};o.addEventListener("message",s,!1),this.handle=o.setInterval(()=>{this.popUp?.closed&&(this.resultInternal$.next({userClosed:!0,receivedUrl:""}),this.cleanUp(s,r))},200)}sendMessageToMainWindow(e,t){let r=this.windowInternal;if(r&&r.opener){let i=r.location.href;this.sendMessage(e,i,t)}}cleanUp(e,t){let r=this.windowInternal;r&&(r.removeEventListener("message",e,!1),r.clearInterval(this.handle),this.popUp&&(this.storagePersistenceService.remove(this.STORAGE_IDENTIFIER,t),this.popUp.close(),this.popUp=null))}sendMessage(e,t,r){let i=this.windowInternal;if(i){if(!e){this.loggerService.logDebug(r,`Can not send message to parent, no url: '${e}'`);return}i.opener.postMessage(e,t)}}getOptions(e){let t={width:500,height:500,left:50,top:50},r=w(w({},t),e||{}),i=this.windowInternal;if(!i)return"";let o=r.width||t.width,s=r.height||t.height,c=i.screenLeft+(i.outerWidth-o)/2,l=i.screenTop+(i.outerHeight-s)/2;return r.left=c,r.top=l,Object.entries(r).map(([d,b])=>`${encodeURIComponent(d)}=${encodeURIComponent(b)}`).join(",")}canAccessSessionStorage(){return typeof navigator<"u"&&navigator.cookieEnabled&&typeof Storage<"u"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),jr=(()=>{class n{constructor(){this.document=a(T)}getStateParamFromCurrentUrl(e){let t=e||this.getCurrentUrl();if(!t)return null;let r=new URL(t);return new URLSearchParams(r.search).get("state")}getCurrentUrl(){return this.document?.defaultView?.location.toString()??null}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ze=(()=>{class n{constructor(){this.checkSessionService=a(Oe),this.currentUrlService=a(jr),this.silentRenewService=a(We),this.userService=a(K),this.loggerService=a(v),this.authStateService=a(M),this.callbackService=a(Ct),this.refreshSessionService=a(_t),this.periodicallyTokenCheckService=a(Or),this.popupService=a(Se),this.autoLoginService=a(ir),this.storagePersistenceService=a(R),this.publicEventsService=a(H)}getConfig(e,t){let r=this.currentUrlService.getStateParamFromCurrentUrl(t);return r?this.getConfigurationWithUrlState([e],r):e}checkAuth(e,t,r){if(!e)return p(()=>new Error("Please provide a configuration before setting up the module"));this.publicEventsService.fireEvent(E.CheckingAuth);let i=this.currentUrlService.getStateParamFromCurrentUrl(r);return this.getConfig(e,r)?this.checkAuthWithConfig(e,t,r):p(()=>new Error(`could not find matching config for state ${i}`))}checkAuthMultiple(e,t){let r=this.currentUrlService.getStateParamFromCurrentUrl(t);if(r){let s=this.getConfigurationWithUrlState(e,r);return s?this.composeMultipleLoginResults(e,s,t):p(()=>new Error(`could not find matching config for state ${r}`))}let i=e,o=i.map(s=>this.checkAuthWithConfig(s,i,t));return $(o)}checkAuthIncludingServer(e,t){return e?this.checkAuthWithConfig(e,t).pipe(D(r=>{let{isAuthenticated:i}=r;return i?u(r):this.refreshSessionService.forceRefreshSession(e,t).pipe(F(o=>{o?.isAuthenticated&&this.startCheckSessionAndValidation(e,t)}))})):p(()=>new Error("Please provide a configuration before setting up the module"))}checkAuthWithConfig(e,t,r){if(!e){let d="Please provide at least one configuration before setting up the module";return this.loggerService.logError(e,d),u({isAuthenticated:!1,errorMessage:d,userData:null,idToken:"",accessToken:"",configId:""})}let i=r||this.currentUrlService.getCurrentUrl();if(!i){let d="No URL found!";return this.loggerService.logError(e,d),u({isAuthenticated:!1,errorMessage:d,userData:null,idToken:"",accessToken:"",configId:""})}let{configId:o,authority:s}=e;if(this.loggerService.logDebug(e,`Working with config '${o}' using '${s}'`),this.popupService.isCurrentlyInPopup(e))return this.popupService.sendMessageToMainWindow(i,e),u({isAuthenticated:!1,errorMessage:"",userData:null,idToken:"",accessToken:"",configId:""});let c=this.callbackService.isCallback(i,e);return this.loggerService.logDebug(e,`currentUrl to check auth with: '${i}'`),(c?this.callbackService.handleCallbackAndFireEvents(i,e,t):u({})).pipe(g(()=>{let d=this.authStateService.areAuthStorageTokensValid(e);return this.loggerService.logDebug(e,`checkAuth completed. Firing events now. isAuthenticated: ${d}`),d&&(this.startCheckSessionAndValidation(e,t),c||(this.authStateService.setAuthenticatedAndFireEvent(t),this.userService.publishUserDataIfExists(e,t))),this.publicEventsService.fireEvent(E.CheckingAuthFinished),{isAuthenticated:d,userData:this.userService.getUserDataFromStore(e),accessToken:this.authStateService.getAccessToken(e),idToken:this.authStateService.getIdToken(e),configId:o}}),F(({isAuthenticated:d})=>{d&&this.autoLoginService.checkSavedRedirectRouteAndNavigate(e)}),x(({message:d})=>(this.loggerService.logError(e,d),this.publicEventsService.fireEvent(E.CheckingAuthFinishedWithError,d),u({isAuthenticated:!1,errorMessage:d,userData:null,idToken:"",accessToken:"",configId:o}))))}startCheckSessionAndValidation(e,t){this.checkSessionService.isCheckSessionConfigured(e)&&this.checkSessionService.start(e),this.periodicallyTokenCheckService.startTokenValidationPeriodically(t,e),this.silentRenewService.isSilentRenewConfigured(e)&&this.silentRenewService.getOrCreateIframe(e)}getConfigurationWithUrlState(e,t){if(!t)return null;for(let r of e)if(this.storagePersistenceService.read("authStateControl",r)===t)return r;return null}composeMultipleLoginResults(e,t,r){let i=e.filter(c=>c.configId!==t.configId),o=this.checkAuthWithConfig(t,e,r),s=i.map(c=>{let{redirectUrl:l}=c;return this.checkAuthWithConfig(c,e,l)});return $([o,...s])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),je=(()=>{class n{constructor(){this.document=a(T)}redirectTo(e){this.document.location.href=e}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),He=(()=>{class n{constructor(){this.loggerService=a(v),this.flowHelper=a(U)}hasConfigValidResponseType(e){return this.flowHelper.isCurrentFlowAnyImplicitFlow(e)||this.flowHelper.isCurrentFlowCodeFlow(e)?!0:(this.loggerService.logWarning(e,"module configured incorrectly, invalid response_type. Check the responseType in the config"),!1)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Hr=(()=>{class n{constructor(){this.loggerService=a(v),this.urlService=a(_),this.dataService=a(V),this.storagePersistenceService=a(R)}postParRequest(e,t){let r=new B;r=r.set("Content-Type","application/x-www-form-urlencoded");let i=this.storagePersistenceService.read("authWellKnownEndPoints",e);if(!i)return p(()=>new Error("Could not read PAR endpoint because authWellKnownEndPoints are not given"));let o=i.parEndpoint;return o?this.urlService.createBodyForParCodeFlowRequest(e,t).pipe(D(s=>this.dataService.post(o,s,e,r).pipe(N(2),g(c=>(this.loggerService.logDebug(e,"par response: ",c),{expiresIn:c.expires_in,requestUri:c.request_uri})),x(c=>{let l="There was an error on ParService postParRequest";return this.loggerService.logError(e,l,c),p(()=>new Error(l))})))):p(()=>new Error("Could not read PAR endpoint from authWellKnownEndpoints"))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Vr=(()=>{class n{constructor(){this.loggerService=a(v),this.responseTypeValidationService=a(He),this.urlService=a(_),this.redirectService=a(je),this.authWellKnownService=a(L),this.popupService=a(Se),this.checkAuthService=a(ze),this.parService=a(Hr)}loginPar(e,t){if(!this.responseTypeValidationService.hasConfigValidResponseType(e)){this.loggerService.logError(e,"Invalid response type!");return}this.loggerService.logDebug(e,"BEGIN Authorize OIDC Flow, no auth data"),this.authWellKnownService.queryAndStoreAuthWellKnownEndPoints(e).pipe(D(()=>this.parService.postParRequest(e,t))).subscribe(r=>{this.loggerService.logDebug(e,"par response: ",r);let i=this.urlService.getAuthorizeParUrl(r.requestUri,e);if(this.loggerService.logDebug(e,"par request url: ",i),!i){this.loggerService.logError(e,`Could not create URL with param ${r.requestUri}: '${i}'`);return}t?.urlHandler?t.urlHandler(i):this.redirectService.redirectTo(i)})}loginWithPopUpPar(e,t,r,i){let{configId:o}=e;if(!this.responseTypeValidationService.hasConfigValidResponseType(e)){let s="Invalid response type!";return this.loggerService.logError(e,s),p(()=>new Error(s))}return this.loggerService.logDebug(e,"BEGIN Authorize OIDC Flow with popup, no auth data"),this.authWellKnownService.queryAndStoreAuthWellKnownEndPoints(e).pipe(D(()=>this.parService.postParRequest(e,r)),D(s=>{this.loggerService.logDebug(e,`par response: ${s}`);let c=this.urlService.getAuthorizeParUrl(s.requestUri,e);if(this.loggerService.logDebug(e,"par request url: ",c),!c){let l=`Could not create URL with param ${s.requestUri}: 'url'`;return this.loggerService.logError(e,l),p(()=>new Error(l))}return this.popupService.openPopUp(c,i,e),this.popupService.result$.pipe(Y(1),D(l=>{let{userClosed:d,receivedUrl:b}=l;return d?u({isAuthenticated:!1,errorMessage:"User closed popup",userData:null,idToken:"",accessToken:"",configId:o}):this.checkAuthService.checkAuth(e,t,b)}))}))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),$r=(()=>{class n{constructor(){this.loggerService=a(v),this.responseTypeValidationService=a(He),this.urlService=a(_),this.authWellKnownService=a(L),this.popupService=a(Se),this.checkAuthService=a(ze)}loginWithPopUpStandard(e,t,r,i){let{configId:o}=e;if(!this.responseTypeValidationService.hasConfigValidResponseType(e)){let s="Invalid response type!";return this.loggerService.logError(e,s),p(()=>new Error(s))}return this.loggerService.logDebug(e,"BEGIN Authorize OIDC Flow with popup, no auth data"),this.authWellKnownService.queryAndStoreAuthWellKnownEndPoints(e).pipe(D(()=>this.urlService.getAuthorizeUrl(e,r)),F(s=>this.popupService.openPopUp(s,i,e)),D(()=>this.popupService.result$.pipe(Y(1),D(s=>{let{userClosed:c,receivedUrl:l}=s;return c?u({isAuthenticated:!1,errorMessage:"User closed popup",userData:null,idToken:"",accessToken:"",configId:o}):this.checkAuthService.checkAuth(e,t,l)}))))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Nr=(()=>{class n{constructor(){this.loggerService=a(v),this.responseTypeValidationService=a(He),this.urlService=a(_),this.redirectService=a(je),this.authWellKnownService=a(L),this.flowsDataService=a(C)}loginStandard(e,t){if(!this.responseTypeValidationService.hasConfigValidResponseType(e)){this.loggerService.logError(e,"Invalid response type!");return}this.loggerService.logDebug(e,"BEGIN Authorize OIDC Flow, no auth data"),this.flowsDataService.setCodeFlowInProgress(e),this.authWellKnownService.queryAndStoreAuthWellKnownEndPoints(e).subscribe(()=>{let{urlHandler:r}=t||{};this.flowsDataService.resetSilentRenewRunning(e),this.urlService.getAuthorizeUrl(e,t).subscribe(i=>{if(!i){this.loggerService.logError(e,"Could not create URL",i);return}r?r(i):this.redirectService.redirectTo(i)})})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Br=(()=>{class n{constructor(){this.parLoginService=a(Vr),this.popUpLoginService=a($r),this.standardLoginService=a(Nr),this.storagePersistenceService=a(R),this.popupService=a(Se)}login(e,t){if(!e)throw new Error("Please provide a configuration before setting up the module");let{usePushedAuthorisationRequests:r}=e;return t?.customParams&&this.storagePersistenceService.write("storageCustomParamsAuthRequest",t.customParams,e),r?this.parLoginService.loginPar(e,t):this.standardLoginService.loginStandard(e,t)}loginWithPopUp(e,t,r,i){if(!e)throw new Error("Please provide a configuration before setting up the module");if(this.popupService.isCurrentlyInPopup(e))return u({errorMessage:"There is already a popup open."});let{usePushedAuthorisationRequests:s}=e;return r?.customParams&&this.storagePersistenceService.write("storageCustomParamsAuthRequest",r.customParams,e),s?this.parLoginService.loginWithPopUpPar(e,t,r,i):this.popUpLoginService.loginWithPopUpStandard(e,t,r,i)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Kr(n){let h=w({},n);for(let e in n)(n[e]===void 0||n[e]===null)&&delete h[e];return h}var Lr=(()=>{class n{constructor(){this.loggerService=a(v),this.dataService=a(V),this.storagePersistenceService=a(R),this.urlService=a(_),this.checkSessionService=a(Oe),this.resetAuthDataService=a(W),this.redirectService=a(je)}logoff(e,t,r){if(!e)return p(()=>new Error("Please provide a configuration before setting up the module"));this.loggerService.logDebug(e,"logoff, remove auth",r);let{urlHandler:i,customParams:o}=r||{},s=this.urlService.getEndSessionUrl(e,o);return s?this.checkSessionService.serverStateChanged(e)?(this.loggerService.logDebug(e,"Server State changed. Logoff was only locally. Returning."),u(null)):i?(this.loggerService.logDebug(e,`Custom UrlHandler found. Using this to handle logoff with url '${s}'`),i(s),this.resetAuthDataService.resetAuthorizationData(e,t),u(null)):this.logoffInternal(r,s,e,t):(this.loggerService.logDebug(e,"No endsessionUrl present. Logoff was only locally. Returning."),u(null))}logoffLocal(e,t){this.resetAuthDataService.resetAuthorizationData(e,t),this.checkSessionService.stop()}logoffLocalMultiple(e){e.forEach(t=>this.logoffLocal(t,e))}logoffAndRevokeTokens(e,t,r){if(!e)return p(()=>new Error("Please provide a configuration before setting up the module"));let{revocationEndpoint:i}=this.storagePersistenceService.read("authWellKnownEndPoints",e)||{};return i?this.storagePersistenceService.getRefreshToken(e)?this.revokeRefreshToken(e).pipe(D(o=>this.revokeAccessToken(e)),x(o=>{let s="revoke token failed";return this.loggerService.logError(e,s,o),p(()=>new Error(s))}),y(()=>this.logoff(e,t,r))):this.revokeAccessToken(e).pipe(x(o=>{let s="revoke accessToken failed";return this.loggerService.logError(e,s,o),p(()=>new Error(s))}),y(()=>this.logoff(e,t,r))):(this.loggerService.logDebug(e,"revocation endpoint not supported"),this.logoff(e,t,r))}revokeAccessToken(e,t){if(!e)return p(()=>new Error("Please provide a configuration before setting up the module"));let r=t||this.storagePersistenceService.getAccessToken(e),i=this.urlService.createRevocationEndpointBodyAccessToken(r,e);return this.sendRevokeRequest(e,i)}revokeRefreshToken(e,t){if(!e)return p(()=>new Error("Please provide a configuration before setting up the module"));let r=t||this.storagePersistenceService.getRefreshToken(e),i=this.urlService.createRevocationEndpointBodyRefreshToken(r,e);return this.sendRevokeRequest(e,i)}logoffInternal(e,t,r,i){let{logoffMethod:o,customParams:s}=e||{};if(!o||o==="GET")return this.redirectService.redirectTo(t),this.resetAuthDataService.resetAuthorizationData(r,i),u(null);let{state:c,logout_hint:l,ui_locales:d}=s||{},{clientId:b}=r,S=this.storagePersistenceService.getIdToken(r),A=this.urlService.getPostLogoutRedirectUrl(r),f=this.getHeaders(),{url:O}=this.urlService.getEndSessionEndpoint(r),z=Kr({id_token_hint:S,client_id:b,post_logout_redirect_uri:A,state:c,logout_hint:l,ui_locales:d});return this.resetAuthDataService.resetAuthorizationData(r,i),this.dataService.post(O,z,r,f)}sendRevokeRequest(e,t){let r=this.urlService.getRevocationEndpointUrl(e),i=this.getHeaders();return this.dataService.post(r,t,e,i).pipe(N(2),D(o=>(this.loggerService.logDebug(e,"revocation endpoint post response: ",o),u(o))),x(o=>{let s="Revocation request failed";return this.loggerService.logError(e,s,o),p(()=>new Error(s))}))}getHeaders(){let e=new B;return e=e.set("Content-Type","application/x-www-form-urlencoded"),e}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),zn=(()=>{class n{constructor(){this.checkSessionService=a(Oe),this.checkAuthService=a(ze),this.userService=a(K),this.tokenHelperService=a(fe),this.configurationService=a(Tt),this.authStateService=a(M),this.flowsDataService=a(C),this.callbackService=a(Ct),this.logoffRevocationService=a(Lr),this.loginService=a(Br),this.refreshSessionService=a(_t),this.urlService=a(_),this.authWellKnownService=a(L),this.userData=he(this.userData$,{requireSync:!0}),this.authenticated=he(this.isAuthenticated$,{requireSync:!0})}get userData$(){return this.userService.userData$}get isAuthenticated$(){return this.authStateService.authenticated$}get checkSessionChanged$(){return this.checkSessionService.checkSessionChanged$}get stsCallback$(){return this.callbackService.stsCallback$}preloadAuthWellKnownDocument(e){return this.configurationService.getOpenIDConfiguration(e).pipe(y(t=>this.authWellKnownService.queryAndStoreAuthWellKnownEndPoints(t)))}getConfigurations(){return this.configurationService.getAllConfigurations()}getConfiguration(e){return this.configurationService.getOpenIDConfiguration(e)}getUserData(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.userService.getUserDataFromStore(t)))}checkAuth(e,t){return this.configurationService.getOpenIDConfigurations(t).pipe(y(({allConfigs:r,currentConfig:i})=>this.checkAuthService.checkAuth(i,r,e)))}checkAuthMultiple(e){return this.configurationService.getOpenIDConfigurations().pipe(y(({allConfigs:t})=>this.checkAuthService.checkAuthMultiple(t,e)))}isAuthenticated(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.authStateService.isAuthenticated(t)))}checkAuthIncludingServer(e){return this.configurationService.getOpenIDConfigurations(e).pipe(y(({allConfigs:t,currentConfig:r})=>this.checkAuthService.checkAuthIncludingServer(r,t)))}getAccessToken(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.authStateService.getAccessToken(t)))}getIdToken(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.authStateService.getIdToken(t)))}getRefreshToken(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.authStateService.getRefreshToken(t)))}getAuthenticationResult(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.authStateService.getAuthenticationResult(t)))}getPayloadFromIdToken(e=!1,t){return this.configurationService.getOpenIDConfiguration(t).pipe(g(r=>{let i=this.authStateService.getIdToken(r);return this.tokenHelperService.getPayloadFromToken(i,e,r)}))}getPayloadFromAccessToken(e=!1,t){return this.configurationService.getOpenIDConfiguration(t).pipe(g(r=>{let i=this.authStateService.getAccessToken(r);return this.tokenHelperService.getPayloadFromToken(i,e,r)}))}setState(e,t){return this.configurationService.getOpenIDConfiguration(t).pipe(g(r=>this.flowsDataService.setAuthStateControl(e,r)))}getState(e){return this.configurationService.getOpenIDConfiguration(e).pipe(g(t=>this.flowsDataService.getAuthStateControl(t)))}authorize(e,t){this.configurationService.getOpenIDConfiguration(e).subscribe(r=>this.loginService.login(r,t))}authorizeWithPopUp(e,t,r){return this.configurationService.getOpenIDConfigurations(r).pipe(y(({allConfigs:i,currentConfig:o})=>this.loginService.loginWithPopUp(o,i,e,t)))}forceRefreshSession(e,t){return this.configurationService.getOpenIDConfigurations(t).pipe(y(({allConfigs:r,currentConfig:i})=>this.refreshSessionService.userForceRefreshSession(i,r,e)))}logoffAndRevokeTokens(e,t){return this.configurationService.getOpenIDConfigurations(e).pipe(y(({allConfigs:r,currentConfig:i})=>this.logoffRevocationService.logoffAndRevokeTokens(i,r,t)))}logoff(e,t){return this.configurationService.getOpenIDConfigurations(e).pipe(y(({allConfigs:r,currentConfig:i})=>this.logoffRevocationService.logoff(i,r,t)))}logoffLocal(e){this.configurationService.getOpenIDConfigurations(e).subscribe(({allConfigs:t,currentConfig:r})=>this.logoffRevocationService.logoffLocal(r,t))}logoffLocalMultiple(){this.configurationService.getOpenIDConfigurations().subscribe(({allConfigs:e})=>this.logoffRevocationService.logoffLocalMultiple(e))}revokeAccessToken(e,t){return this.configurationService.getOpenIDConfiguration(t).pipe(y(r=>this.logoffRevocationService.revokeAccessToken(r,e)))}revokeRefreshToken(e,t){return this.configurationService.getOpenIDConfiguration(t).pipe(y(r=>this.logoffRevocationService.revokeRefreshToken(r,e)))}getEndSessionUrl(e,t){return this.configurationService.getOpenIDConfiguration(t).pipe(g(r=>this.urlService.getEndSessionUrl(r,e)))}getAuthorizeUrl(e,t){return this.configurationService.getOpenIDConfiguration(t).pipe(y(r=>this.urlService.getAuthorizeUrl(r,e?{customParams:e}:void 0)))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),qr=(()=>{class n{read(e){return sessionStorage.getItem(e)}write(e,t){sessionStorage.setItem(e,t)}remove(e){sessionStorage.removeItem(e)}clear(){sessionStorage.clear()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function jn(n,...h){let e=Jr(n);for(let t of h)e.push(...t.\u0275providers);return qe(e)}function Jr(n){return[{provide:gt,useValue:n},n?.loader||{provide:pe,useFactory:qt,deps:[gt]},{provide:Dt,useClass:qr},{provide:It,useClass:Jt}]}export{cn as a,ln as b,dn as c,zn as d,jn as e};
